"use strict";function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _get=function(t,e,r){for(var a=!0;a;){var n=t,i=e,s=r;o=l=c=void 0,a=!1,null===n&&(n=Function.prototype);var o=Object.getOwnPropertyDescriptor(n,i);if(void 0!==o){if("value"in o)return o.value;var c=o.get;return void 0===c?void 0:c.call(s)}var l=Object.getPrototypeOf(n);if(null===l)return void 0;t=l,e=i,r=s,a=!0}},_createClass=function(){function t(t,e){for(var r=0;r<e.length;r++){var a=e[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,r,a){return r&&t(e.prototype,r),a&&t(e,a),e}}(),Map=function(){function t(e){_classCallCheck(this,t),this.scale=e.width/1e3,this.svg=this.createSVGElement("svg",{width:e.width,height:e.height}),e.container.appendChild(this.svg);var r=!0,a=!1,n=void 0;try{for(var i,s=Object.keys(e.worldmap.shapes)[Symbol.iterator]();!(r=(i=s.next()).done);r=!0){var o=i.value,c=this.createSVGElement("path",{stroke:"#ccc6ae",fill:"#000",d:e.worldmap.shapes[o],transform:"scale("+this.scale+")"});this.svg.appendChild(c)}}catch(l){a=!0,n=l}finally{try{!r&&s["return"]&&s["return"]()}finally{if(a)throw n}}this.container={},this.count=0}return _createClass(t,[{key:"createSVGElement",value:function(t,e){var r=document.createElementNS("http://www.w3.org/2000/svg",t);return this.setAttr(r,e)}},{key:"setAttr",value:function(t,e){var r=!0,a=!1,n=void 0;try{for(var i,s=Object.keys(e)[Symbol.iterator]();!(r=(i=s.next()).done);r=!0){var o=i.value;t.setAttribute(o,e[o])}}catch(c){a=!0,n=c}finally{try{!r&&s["return"]&&s["return"]()}finally{if(a)throw n}}return t}},{key:"trigger",value:function(t,e){t=this.getXY(t),e=this.getXY(e);var r=+new Date,a="#21b384",n="#e32528";if(!this.container[r]){var i={"stroke-width":2,"fill:":"none",r:0,opacity:1},s=this.createSVGElement("circle",i),o=this.createSVGElement("circle",i);i={stroke:n,"stroke-width":5,opacity:.5,"stroke-linecap":"round",d:"M"+t.cx+" "+t.cy+" L"+e.cx+" "+e.cy};var c=this.createSVGElement("path",i),l=c.getTotalLength();this.setAttr(c,{"stroke-dasharray":l,"stroke-dashoffset":l}),this.setAttr(s,{stroke:a,cx:t.cx,cy:t.cy}),this.setAttr(o,{stroke:n,cx:e.cx,cy:e.cy}),this.svg.appendChild(s),this.svg.appendChild(o),this.svg.appendChild(c);var u={startCircle:s,endCircle:o,path:c,totalLength:l,duration:1e3,radius:70+parseInt(20*Math.random()),stage:0};this.container[r]=u,this.count++||this.draw()}}},{key:"draw",value:function(){var t=+new Date,e=!0,r=!1,a=void 0;try{for(var n,i=Object.keys(this.container)[Symbol.iterator]();!(e=(n=i.next()).done);e=!0){var s=n.value,o=t-s,c=this.container[s];if(o<c.duration){var l=this.easeOutQuint(o,0,c.radius,c.duration),u=this.easeOutQuint(o,c.totalLength,-2*c.totalLength,c.duration),h=this.easeOutQuint(o,1,-1,c.duration);this.setAttr(c.startCircle,{r:l,opacity:h}),this.setAttr(c.path,{"stroke-dashoffset":u})}else if(o<2*c.duration){0===c.stage&&(this.svg.removeChild(c.startCircle),this.svg.removeChild(c.path),c.stage=1);var l=this.easeOutQuint(o-c.duration,0,c.radius,c.duration),h=this.easeOutQuint(o-c.duration,1,-1,c.duration);this.setAttr(c.endCircle,{r:l,opacity:h})}else this.svg.removeChild(c.endCircle),delete this.container[s],this.count--}}catch(p){r=!0,a=p}finally{try{!e&&i["return"]&&i["return"]()}finally{if(r)throw a}}this.count&&window.requestAnimationFrame(this.draw.bind(this))}},{key:"getXY",value:function(t){return{cx:(2.6938*t.lon+465.4)*this.scale,cy:(-2.6938*t.lat+227.066)*this.scale}}},{key:"easeOutQuint",value:function(t,e,r,a){return r*Math.sin(t/a*(Math.PI/2))+e}}]),t}(),AttackList=function(t){function e(){_classCallCheck(this,e),_get(Object.getPrototypeOf(e.prototype),"constructor",this).apply(this,arguments)}return _inherits(e,t),_createClass(e,[{key:"render",value:function(){var t=[],e=!0,r=!1,a=void 0;try{for(var n,i=Object.keys(this.props.list)[Symbol.iterator]();!(e=(n=i.next()).done);e=!0){var s=n.value;t.push({country:s,count:this.props.list[s]})}}catch(o){r=!0,a=o}finally{try{!e&&i["return"]&&i["return"]()}finally{if(r)throw a}}return React.createElement("table",{className:this.props.className},React.createElement("tr",null,React.createElement("th",null,"attackorigin"==this.props.className?"Origin":"Targets"),React.createElement("th",null,"Count")),t.sort(function(t,e){return e.count-t.count}).slice(0,9).map(function(t){return React.createElement("tr",null,React.createElement("td",null,t.country),React.createElement("td",null,t.count))}))}}]),e}(React.Component),RealTimeList=function(t){function e(){_classCallCheck(this,e),_get(Object.getPrototypeOf(e.prototype),"constructor",this).apply(this,arguments)}return _inherits(e,t),_createClass(e,[{key:"render",value:function(){return React.createElement("table",{className:this.props.className},React.createElement("tr",null,React.createElement("th",null,"Time"),React.createElement("th",null,"Origin"),React.createElement("th",null,"Targets"),React.createElement("th",null,"Type")),this.props.realtime.map(function(t){return React.createElement("tr",null,React.createElement("td",{width:"200"},t.Time),React.createElement("td",null,t.Origin),React.createElement("td",{width:"200"},t.Targets),React.createElement("td",null,t.Type))}))}}]),e}(React.Component),Info=function(t){function e(){_classCallCheck(this,e),_get(Object.getPrototypeOf(e.prototype),"constructor",this).apply(this,arguments)}return _inherits(e,t),_createClass(e,[{key:"render",value:function(){return React.createElement("div",{className:"info"},React.createElement(AttackList,{list:this.props.origin,className:"attackorigin"}),React.createElement(AttackList,{list:this.props.targets,className:"attacktargets"}),React.createElement(RealTimeList,{realtime:this.props.realtime,className:"realtime"}))}}]),e}(React.Component),map=new Map({container:document.querySelector(".map"),width:screen.width,height:.4*screen.width,worldmap:worldmap}),list=document.querySelector(".list"),origin={},targets={},realtime=[],ws=new WebSocket("ws://mbsd.ipviking.com:443");ws.onmessage=function(t){var e=JSON.parse(t.data),r={lat:+e.latitude,lon:+e.longitude},a={lat:+e.latitude2,lon:+e.longitude2},n=worldmap.name[e.countrycode]||"Unknow";origin[n]?origin[n]++:origin[n]=1;var i=worldmap.name[e.countrycode2]||"Unknow";targets[i]?targets[i]++:targets[i]=1,realtime.push({Time:(new Date).toLocaleString(),Origin:n,Targets:i,Type:services[e.dport]||"Unknow"}),realtime.length>8&&realtime.shift(),React.render(React.createElement(Info,{className:"info",origin:origin,targets:targets,realtime:realtime}),list),map.trigger(r,a)};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1hcC5qcyIsImluZm8uanN4IiwiYm9vdC5qcyJdLCJuYW1lcyI6WyJfaW5oZXJpdHMiLCJzdWJDbGFzcyIsInN1cGVyQ2xhc3MiLCJUeXBlRXJyb3IiLCJwcm90b3R5cGUiLCJPYmplY3QiLCJjcmVhdGUiLCJjb25zdHJ1Y3RvciIsInZhbHVlIiwiZW51bWVyYWJsZSIsIndyaXRhYmxlIiwiY29uZmlndXJhYmxlIiwic2V0UHJvdG90eXBlT2YiLCJfX3Byb3RvX18iLCJfY2xhc3NDYWxsQ2hlY2siLCJpbnN0YW5jZSIsIkNvbnN0cnVjdG9yIiwiX2dldCIsIl94IiwiX3gyIiwiX3gzIiwiX2FnYWluIiwib2JqZWN0IiwicHJvcGVydHkiLCJyZWNlaXZlciIsImRlc2MiLCJwYXJlbnQiLCJnZXR0ZXIiLCJ1bmRlZmluZWQiLCJGdW5jdGlvbiIsImdldE93blByb3BlcnR5RGVzY3JpcHRvciIsImdldCIsImNhbGwiLCJnZXRQcm90b3R5cGVPZiIsIl9jcmVhdGVDbGFzcyIsImRlZmluZVByb3BlcnRpZXMiLCJ0YXJnZXQiLCJwcm9wcyIsImkiLCJsZW5ndGgiLCJkZXNjcmlwdG9yIiwiZGVmaW5lUHJvcGVydHkiLCJrZXkiLCJwcm90b1Byb3BzIiwic3RhdGljUHJvcHMiLCJNYXAiLCJvcHRpb24iLCJ0aGlzIiwic2NhbGUiLCJ3aWR0aCIsInN2ZyIsImNyZWF0ZVNWR0VsZW1lbnQiLCJoZWlnaHQiLCJjb250YWluZXIiLCJhcHBlbmRDaGlsZCIsIl9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24iLCJfZGlkSXRlcmF0b3JFcnJvciIsIl9pdGVyYXRvckVycm9yIiwiX3N0ZXAiLCJfaXRlcmF0b3IiLCJrZXlzIiwid29ybGRtYXAiLCJzaGFwZXMiLCJTeW1ib2wiLCJpdGVyYXRvciIsIm5leHQiLCJkb25lIiwiY291bnRyeSIsInBhdGgiLCJzdHJva2UiLCJmaWxsIiwiZCIsInRyYW5zZm9ybSIsImVyciIsImNvdW50IiwibmFtZSIsImF0dHIiLCJlbGUiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnROUyIsInNldEF0dHIiLCJfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uMiIsIl9kaWRJdGVyYXRvckVycm9yMiIsIl9pdGVyYXRvckVycm9yMiIsIl9zdGVwMiIsIl9pdGVyYXRvcjIiLCJzZXRBdHRyaWJ1dGUiLCJzdGFydCIsImVuZCIsImdldFhZIiwidGltZXN0YW1wIiwiRGF0ZSIsInN0YXJ0Q29sb3IiLCJlbmRDb2xvciIsInN0cm9rZS13aWR0aCIsImZpbGw6IiwiciIsIm9wYWNpdHkiLCJzdGFydENpcmNsZSIsImVuZENpcmNsZSIsInN0cm9rZS1saW5lY2FwIiwiY3giLCJjeSIsImxpbmUiLCJ0b3RhbExlbmd0aCIsImdldFRvdGFsTGVuZ3RoIiwic3Ryb2tlLWRhc2hhcnJheSIsInN0cm9rZS1kYXNob2Zmc2V0IiwiaW5mbyIsImR1cmF0aW9uIiwicmFkaXVzIiwicGFyc2VJbnQiLCJNYXRoIiwicmFuZG9tIiwic3RhZ2UiLCJkcmF3Iiwibm93IiwiX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbjMiLCJfZGlkSXRlcmF0b3JFcnJvcjMiLCJfaXRlcmF0b3JFcnJvcjMiLCJfc3RlcDMiLCJfaXRlcmF0b3IzIiwidGltZSIsImVhc2VPdXRRdWludCIsImRhc2hvZmZzZXQiLCJyZW1vdmVDaGlsZCIsIndpbmRvdyIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsImJpbmQiLCJsb24iLCJsYXQiLCJ0IiwiYiIsImMiLCJzaW4iLCJQSSIsIkF0dGFja0xpc3QiLCJfUmVhY3QkQ29tcG9uZW50IiwiYXBwbHkiLCJhcmd1bWVudHMiLCJfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uNCIsIl9kaWRJdGVyYXRvckVycm9yNCIsIl9pdGVyYXRvckVycm9yNCIsIl9zdGVwNCIsIl9pdGVyYXRvcjQiLCJsaXN0IiwicHVzaCIsIlJlYWN0IiwiY3JlYXRlRWxlbWVudCIsImNsYXNzTmFtZSIsInNvcnQiLCJhIiwic2xpY2UiLCJtYXAiLCJpdGVtIiwiQ29tcG9uZW50IiwiUmVhbFRpbWVMaXN0IiwiX1JlYWN0JENvbXBvbmVudDIiLCJyZWFsdGltZSIsIlRpbWUiLCJPcmlnaW4iLCJUYXJnZXRzIiwiVHlwZSIsIkluZm8iLCJfUmVhY3QkQ29tcG9uZW50MyIsIm9yaWdpbiIsInRhcmdldHMiLCJxdWVyeVNlbGVjdG9yIiwic2NyZWVuIiwid3MiLCJXZWJTb2NrZXQiLCJvbm1lc3NhZ2UiLCJlIiwiZGF0YSIsIkpTT04iLCJwYXJzZSIsIm9yaUNvdW50cnkiLCJ0YXJDb3VudHJ5IiwidG9Mb2NhbGVTdHJpbmciLCJzZXJ2aWNlcyIsInNoaWZ0IiwicmVuZGVyIiwidHJpZ2dlciJdLCJtYXBwaW5ncyI6IkFBQUEsWUFNQSxTQUFTQSxXQUFVQyxFQUFVQyxHQUFjLEdBQTBCLGtCQUFmQSxJQUE0QyxPQUFmQSxFQUF1QixLQUFNLElBQUlDLFdBQVUsaUVBQW9FRCxHQUFlRCxHQUFTRyxVQUFZQyxPQUFPQyxPQUFPSixHQUFjQSxFQUFXRSxXQUFhRyxhQUFlQyxNQUFPUCxFQUFVUSxZQUFZLEVBQU9DLFVBQVUsRUFBTUMsY0FBYyxLQUFlVCxJQUFZRyxPQUFPTyxlQUFpQlAsT0FBT08sZUFBZVgsRUFBVUMsR0FBY0QsRUFBU1ksVUFBWVgsR0FFamUsUUFBU1ksaUJBQWdCQyxFQUFVQyxHQUFlLEtBQU1ELFlBQW9CQyxJQUFnQixLQUFNLElBQUliLFdBQVUscUNBTmhILEdBQUljLE1BQU8sU0FBYUMsRUFBSUMsRUFBS0MsR0FBcUMsSUFBOUIsR0FBSUMsSUFBUyxFQUF3QkEsR0FBUSxDQUFFLEdBQUlDLEdBQVNKLEVBQUlLLEVBQVdKLEVBQUtLLEVBQVdKLENBQUtLLEdBQU9DLEVBQVNDLEVBQVNDLE9BQVdQLEdBQVMsRUFBc0IsT0FBWEMsSUFBaUJBLEVBQVNPLFNBQVN6QixVQUFXLElBQUlxQixHQUFPcEIsT0FBT3lCLHlCQUF5QlIsRUFBUUMsRUFBVyxJQUFhSyxTQUFUSCxFQUFKLENBQWlOLEdBQUksU0FBV0EsR0FBUSxNQUFPQSxHQUFLakIsS0FBZ0IsSUFBSW1CLEdBQVNG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QUFXLEtBQUFYLE9BQUFXLEdBQUEsQ0FDQSxJQUFBQyxHQUFBcEgsU0FBQWMsS0FBQWtHLEVBQUEsZUFBQSxRQUNBUCxTQUFBVyxHQUFBWCxRQUFBVyxLQUFBWCxRQUFBVyxHQUFBLEVBRUFuQixTQUFBWixNQUNBYSxNQUFBLEdBQUFwRSxPQUFBdUYsaUJBQ0FsQixPQUFBZ0IsRUFDQWYsUUFBQWdCLEVBQ0FmLEtBQUFpQixTQUFBTixFQUFBLFFBQUEsV0FHQWYsU0FBQXZILE9BQUEsR0FBQXVILFNBQUFzQixRQUVBakMsTUFBQWtDLE9BQ0FsQyxNQUFBQyxjQUFBZSxNQUFBZCxVQUFBLE9BQUFnQixPQUFBQSxPQUFBQyxRQUFBQSxRQUFBUixTQUFBQSxXQUNBYixNQUVBUSxJQUFBNkIsUUFBQS9GLEVBQUFDIiwiZmlsZSI6Im1hcC5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcclxuY2xhc3MgTWFwIHtcclxuICAgIGNvbnN0cnVjdG9yKG9wdGlvbikge1xyXG4gICAgICAgIHRoaXMuc2NhbGUgPSBvcHRpb24ud2lkdGggLyAxMDAwO1xyXG4gICAgICAgIHRoaXMuc3ZnID0gdGhpcy5jcmVhdGVTVkdFbGVtZW50KCdzdmcnLCB7XHJcbiAgICAgICAgICAgIHdpZHRoOiBvcHRpb24ud2lkdGgsXHJcbiAgICAgICAgICAgIGhlaWdodDogb3B0aW9uLmhlaWdodFxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIG9wdGlvbi5jb250YWluZXIuYXBwZW5kQ2hpbGQodGhpcy5zdmcpO1xyXG4gICAgICAgIGZvciAobGV0IGNvdW50cnkgb2YgT2JqZWN0LmtleXMob3B0aW9uLndvcmxkbWFwLnNoYXBlcykpIHtcclxuICAgICAgICAgICAgY29uc3QgcGF0aCA9IHRoaXMuY3JlYXRlU1ZHRWxlbWVudCgncGF0aCcsIHtcclxuICAgICAgICAgICAgICAgIHN0cm9rZTogXCIjY2NjNmFlXCIsXHJcbiAgICAgICAgICAgICAgICBmaWxsOiBcIiMwMDBcIixcclxuICAgICAgICAgICAgICAgIGQ6IG9wdGlvbi53b3JsZG1hcC5zaGFwZXNbY291bnRyeV0sXHJcbiAgICAgICAgICAgICAgICB0cmFuc2Zvcm06IGBzY2FsZSgkeyB0aGlzLnNjYWxlIH0pYFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgdGhpcy5zdmcuYXBwZW5kQ2hpbGQocGF0aCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmNvbnRhaW5lciA9IHt9O1xyXG4gICAgICAgIHRoaXMuY291bnQgPSAwOy8vIHF1ZXVl5oC75pWwXHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBTVkdFbGVtZW50XHJcbiAgICAgKiBAcGFyYW0gIHtTdHJpbmd9IG5hbWVcclxuICAgICAqIEBwYXJhbSAge09iamVjdH0gYXR0clxyXG4gICAgICogQHJldHVybiB7RWxlbWVudH1cclxuICAgICAqL1xyXG4gICAgY3JlYXRlU1ZHRWxlbWVudChuYW1lLCBhdHRyKSB7XHJcbiAgICAgICAgbGV0IGVsZSA9ICBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoJ2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJywgbmFtZSk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuc2V0QXR0cihlbGUsIGF0dHIpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogc2V0IGF0dHJcclxuICAgICAqIEBwYXJhbSB7RWxlbWVudH0gZWxlXHJcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gYXR0clxyXG4gICAgICovXHJcbiAgICBzZXRBdHRyKGVsZSwgYXR0cikge1xyXG4gICAgICAgIGZvcihsZXQga2V5IG9mIE9iamVjdC5rZXlzKGF0dHIpKSB7XHJcbiAgICAgICAgICAgIGVsZS5zZXRBdHRyaWJ1dGUoa2V5LCBhdHRyW2tleV0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZWxlO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog6Kem5Y+R5Yqo55S7XHJcbiAgICAgKiBAcGFyYW0gIHtPYmplY3R9IHN0YXJ0XHJcbiAgICAgKiBAcGFyYW0gIHtPYmplY3R9IGVuZFxyXG4gICAgICogQHJldHVybiB7bnVsbH1cclxuICAgICAqL1xyXG4gICAgdHJpZ2dlcihzdGFydCwgZW5kKSB7XHJcbiAgICAgICAgc3RhcnQgPSB0aGlzLmdldFhZKHN0YXJ0KTtcclxuICAgICAgICBlbmQgPSB0aGlzLmdldFhZKGVuZCk7XHJcbiAgICAgICAgY29uc3QgdGltZXN0YW1wID0gK25ldyBEYXRlO1xyXG4gICAgICAgIGNvbnN0IHN0YXJ0Q29sb3IgPSAnIzIxYjM4NCc7XHJcbiAgICAgICAgY29uc3QgZW5kQ29sb3IgPSAnI2UzMjUyOCc7XHJcbiAgICAgICAgaWYodGhpcy5jb250YWluZXJbdGltZXN0YW1wXSkgcmV0dXJuOy8vIOaXoOWliFxyXG4gICAgICAgIGxldCBvcHRpb24gPSB7XHJcbiAgICAgICAgICAgICdzdHJva2Utd2lkdGgnOiAyLFxyXG4gICAgICAgICAgICAnZmlsbDonOiAnbm9uZScsXHJcbiAgICAgICAgICAgIHI6IDAsXHJcbiAgICAgICAgICAgIG9wYWNpdHk6IDFcclxuICAgICAgICB9XHJcbiAgICAgICAgbGV0IHN0YXJ0Q2lyY2xlID0gdGhpcy5jcmVhdGVTVkdFbGVtZW50KCdjaXJjbGUnLCBvcHRpb24pO1xyXG4gICAgICAgIGxldCBlbmRDaXJjbGUgPSB0aGlzLmNyZWF0ZVNWR0VsZW1lbnQoJ2NpcmNsZScsIG9wdGlvbik7XHJcbiAgICAgICAgb3B0aW9uID0ge1xyXG4gICAgICAgICAgICBzdHJva2U6IGVuZENvbG9yLFxyXG4gICAgICAgICAgICAnc3Ryb2tlLXdpZHRoJzogNSxcclxuICAgICAgICAgICAgb3BhY2l0eTogMC41LFxyXG4gICAgICAgICAgICAnc3Ryb2tlLWxpbmVjYXAnOiAncm91bmQnLFxyXG4gICAgICAgICAgICBkOiBgTSR7IHN0YXJ0LmN4IH0gJHsgc3RhcnQuY3kgfSBMJHsgZW5kLmN4IH0gJHsgZW5kLmN5IH1gXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxldCBsaW5lID0gdGhpcy5jcmVhdGVTVkdFbGVtZW50KCdwYXRoJywgb3B0aW9uKTtcclxuICAgICAgICBjb25zdCB0b3RhbExlbmd0aCA9IGxpbmUuZ2V0VG90YWxMZW5ndGgoKTtcclxuICAgICAgICB0aGlzLnNldEF0dHIobGluZSwge1xyXG4gICAgICAgICAgICAnc3Ryb2tlLWRhc2hhcnJheSc6IHRvdGFsTGVuZ3RoLFxyXG4gICAgICAgICAgICAnc3Ryb2tlLWRhc2hvZmZzZXQnOiB0b3RhbExlbmd0aFxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMuc2V0QXR0cihzdGFydENpcmNsZSwge1xyXG4gICAgICAgICAgICBzdHJva2U6IHN0YXJ0Q29sb3IsXHJcbiAgICAgICAgICAgIGN4OiBzdGFydC5jeCxcclxuICAgICAgICAgICAgY3k6IHN0YXJ0LmN5XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5zZXRBdHRyKGVuZENpcmNsZSwge1xyXG4gICAgICAgICAgICBzdHJva2U6IGVuZENvbG9yLFxyXG4gICAgICAgICAgICBjeDogZW5kLmN4LFxyXG4gICAgICAgICAgICBjeTogZW5kLmN5XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5zdmcuYXBwZW5kQ2hpbGQoc3RhcnRDaXJjbGUpO1xyXG4gICAgICAgIHRoaXMuc3ZnLmFwcGVuZENoaWxkKGVuZENpcmNsZSk7XHJcbiAgICAgICAgdGhpcy5zdmcuYXBwZW5kQ2hpbGQobGluZSk7XHJcbiAgICAgICAgbGV0IGluZm8gPSB7XHJcbiAgICAgICAgICAgIHN0YXJ0Q2lyY2xlOiBzdGFydENpcmNsZSxcclxuICAgICAgICAgICAgZW5kQ2lyY2xlOiBlbmRDaXJjbGUsXHJcbiAgICAgICAgICAgIHBhdGg6IGxpbmUsXHJcbiAgICAgICAgICAgIHRvdGFsTGVuZ3RoOiB0b3RhbExlbmd0aCxcclxuICAgICAgICAgICAgZHVyYXRpb246IDEwMDAsXHJcbiAgICAgICAgICAgIHJhZGl1czogNzAgKyBwYXJzZUludChNYXRoLnJhbmRvbSgpICogMjApLFxyXG4gICAgICAgICAgICBzdGFnZTogMFxyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmNvbnRhaW5lclt0aW1lc3RhbXBdID0gaW5mbztcclxuICAgICAgICBpZighKHRoaXMuY291bnQpKyspIHtcclxuICAgICAgICAgICAgdGhpcy5kcmF3KCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5riy5p+TXHJcbiAgICAgKiBAcmV0dXJuIHtudWxsfVxyXG4gICAgICovXHJcbiAgICBkcmF3KCkge1xyXG4gICAgICAgIGNvbnN0IG5vdyA9ICtuZXcgRGF0ZTtcclxuICAgICAgICBmb3IobGV0IGtleSBvZiBPYmplY3Qua2V5cyh0aGlzLmNvbnRhaW5lcikpIHtcclxuICAgICAgICAgICAgY29uc3QgdGltZSA9IG5vdyAtIGtleTtcclxuICAgICAgICAgICAgY29uc3QgaW5mbyA9IHRoaXMuY29udGFpbmVyW2tleV07XHJcbiAgICAgICAgICAgIGlmKHRpbWUgPCBpbmZvLmR1cmF0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCByID0gdGhpcy5lYXNlT3V0UXVpbnQodGltZSwgMCwgaW5mby5yYWRpdXMsIGluZm8uZHVyYXRpb24pO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZGFzaG9mZnNldCA9IHRoaXMuZWFzZU91dFF1aW50KHRpbWUsIGluZm8udG90YWxMZW5ndGgsIC0yICogaW5mby50b3RhbExlbmd0aCwgaW5mby5kdXJhdGlvbik7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBvcGFjaXR5ID0gdGhpcy5lYXNlT3V0UXVpbnQodGltZSwgMSwgLTEsIGluZm8uZHVyYXRpb24pO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXRBdHRyKGluZm8uc3RhcnRDaXJjbGUsIHtcclxuICAgICAgICAgICAgICAgICAgICByOiByLFxyXG4gICAgICAgICAgICAgICAgICAgIG9wYWNpdHk6IG9wYWNpdHlcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXRBdHRyKGluZm8ucGF0aCwge1xyXG4gICAgICAgICAgICAgICAgICAgICdzdHJva2UtZGFzaG9mZnNldCc6IGRhc2hvZmZzZXRcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYodGltZSA8IGluZm8uZHVyYXRpb24gKiAyKSB7XHJcbiAgICAgICAgICAgICAgICBpZihpbmZvLnN0YWdlID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdmcucmVtb3ZlQ2hpbGQoaW5mby5zdGFydENpcmNsZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdmcucmVtb3ZlQ2hpbGQoaW5mby5wYXRoKTtcclxuICAgICAgICAgICAgICAgICAgICBpbmZvLnN0YWdlID0gMTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmVhc2VPdXRRdWludCh0aW1lIC0gaW5mby5kdXJhdGlvbiwgMCwgaW5mby5yYWRpdXMsIGluZm8uZHVyYXRpb24pO1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgb3BhY2l0eSA9IHRoaXMuZWFzZU91dFF1aW50KHRpbWUgLSBpbmZvLmR1cmF0aW9uLCAxLCAtMSwgaW5mby5kdXJhdGlvbik7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNldEF0dHIoaW5mby5lbmRDaXJjbGUsIHtcclxuICAgICAgICAgICAgICAgICAgICByOiByLFxyXG4gICAgICAgICAgICAgICAgICAgIG9wYWNpdHk6IG9wYWNpdHlcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zdmcucmVtb3ZlQ2hpbGQoaW5mby5lbmRDaXJjbGUpO1xyXG4gICAgICAgICAgICAgICAgZGVsZXRlIHRoaXMuY29udGFpbmVyW2tleV07XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNvdW50LS07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYodGhpcy5jb3VudCkge1xyXG4gICAgICAgICAgICB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKHRoaXMuZHJhdy5iaW5kKHRoaXMpKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDnu4/nuqzluqYyWFlcclxuICAgICAqIEBwYXJhbSAge09iamVjdH0gb3B0aW9uXHJcbiAgICAgKiBAcmV0dXJuIHtPYmplY3R9XHJcbiAgICAgKi9cclxuICAgIGdldFhZIChvcHRpb24pIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBjeDogKG9wdGlvbi5sb24gKiAyLjY5MzggKyA0NjUuNCkgKiB0aGlzLnNjYWxlLFxyXG4gICAgICAgICAgICBjeTogKG9wdGlvbi5sYXQgKiAtMi42OTM4ICsgMjI3LjA2NikgKiB0aGlzLnNjYWxlXHJcbiAgICAgICAgfTtcclxuICAgIH07XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDnvJPliqjlh73mlbBcclxuICAgICAqIEBwYXJhbSAge051bWJlcn0gdCDlh4bnoa7ml7bpl7RcclxuICAgICAqIEBwYXJhbSAge051bWJlcn0gYiDlvIDlp4vlgLxcclxuICAgICAqIEBwYXJhbSAge051bWJlcn0gYyDmlLnlj5jlgLxcclxuICAgICAqIEBwYXJhbSAge051bWJlcn0gZCDmgLvml7bpl7RcclxuICAgICAqIEByZXR1cm4ge051bWJlcn0gICB2YWx1ZVxyXG4gICAgICovXHJcbiAgICAgZWFzZU91dFF1aW50ICh0LCBiLCBjLCBkKSB7XHJcbiBcdFx0cmV0dXJuIGMgKiBNYXRoLnNpbih0L2QgKiAoTWF0aC5QSS8yKSkgKyBiO1xyXG4gXHR9XHJcbn1cclxuIiwiY2xhc3MgQXR0YWNrTGlzdCBleHRlbmRzIFJlYWN0LkNvbXBvbmVudCB7XHJcbiAgICByZW5kZXIoKSB7XHJcbiAgICAgICAgbGV0IGNvdW50cnkgPSBbXTtcclxuICAgICAgICBmb3IobGV0IGtleSBvZiBPYmplY3Qua2V5cyh0aGlzLnByb3BzLmxpc3QpKSB7XHJcbiAgICAgICAgICAgIGNvdW50cnkucHVzaCh7XHJcbiAgICAgICAgICAgICAgICBjb3VudHJ5OiBrZXksXHJcbiAgICAgICAgICAgICAgICBjb3VudDogdGhpcy5wcm9wcy5saXN0W2tleV1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gKFxyXG4gICAgICAgICAgICA8dGFibGUgY2xhc3NOYW1lPXsgdGhpcy5wcm9wcy5jbGFzc05hbWUgfT5cclxuICAgICAgICAgICAgICAgIDx0cj5cclxuICAgICAgICAgICAgICAgICAgPHRoPnsgdGhpcy5wcm9wcy5jbGFzc05hbWUgPT0gJ2F0dGFja29yaWdpbicgPyAnT3JpZ2luJyA6ICdUYXJnZXRzJyB9PC90aD5cclxuICAgICAgICAgICAgICAgICAgPHRoPkNvdW50PC90aD5cclxuICAgICAgICAgICAgICAgIDwvdHI+XHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgY291bnRyeVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuc29ydCgoYSwgYikgPT4gYi5jb3VudCAtIGEuY291bnQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zbGljZSgwLCA5KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAubWFwKChpdGVtKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0cj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ZD57IGl0ZW0uY291bnRyeSB9PC90ZD5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ZD57IGl0ZW0uY291bnQgfTwvdGQ+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC90cj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIDwvdGFibGU+XHJcbiAgICAgICAgKTtcclxuICAgIH1cclxufVxyXG5cclxuY2xhc3MgUmVhbFRpbWVMaXN0IGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50IHtcclxuICAgIHJlbmRlciAoKSB7XHJcblxyXG4gICAgICAgIHJldHVybiAoXHJcbiAgICAgICAgICAgIDx0YWJsZSBjbGFzc05hbWU9eyB0aGlzLnByb3BzLmNsYXNzTmFtZSB9PlxyXG4gICAgICAgICAgICAgICAgPHRyPlxyXG4gICAgICAgICAgICAgICAgICA8dGg+VGltZTwvdGg+XHJcbiAgICAgICAgICAgICAgICAgIDx0aD5PcmlnaW48L3RoPlxyXG4gICAgICAgICAgICAgICAgICA8dGg+VGFyZ2V0czwvdGg+XHJcbiAgICAgICAgICAgICAgICAgIDx0aD5UeXBlPC90aD5cclxuICAgICAgICAgICAgICAgIDwvdHI+XHJcbiAgICAgICAgICAgICAgICB7IHRoaXMucHJvcHMucmVhbHRpbWUubWFwKChpdGVtKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChcclxuICAgICAgICAgICAgICAgICAgICAgICAgPHRyPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIDx0ZCB3aWR0aD1cIjIwMFwiPnsgaXRlbS5UaW1lIH08L3RkPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIDx0ZD57IGl0ZW0uT3JpZ2luIH08L3RkPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIDx0ZCB3aWR0aD1cIjIwMFwiPnsgaXRlbS5UYXJnZXRzIH08L3RkPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIDx0ZD57IGl0ZW0uVHlwZSB9PC90ZD5cclxuICAgICAgICAgICAgICAgICAgICAgICAgPC90cj5cclxuICAgICAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgICAgfSkgfVxyXG4gICAgICAgICAgICA8L3RhYmxlPlxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcbn1cclxuXHJcbmNsYXNzIEluZm8gZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQge1xyXG4gICAgcmVuZGVyKCkge1xyXG4gICAgICAgIHJldHVybiAoXHJcbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiaW5mb1wiPlxyXG4gICAgICAgICAgICAgICAgPEF0dGFja0xpc3QgbGlzdD17IHRoaXMucHJvcHMub3JpZ2luIH0gY2xhc3NOYW1lPVwiYXR0YWNrb3JpZ2luXCIgLz5cclxuICAgICAgICAgICAgICAgIDxBdHRhY2tMaXN0IGxpc3Q9eyB0aGlzLnByb3BzLnRhcmdldHMgfSBjbGFzc05hbWU9XCJhdHRhY2t0YXJnZXRzXCIgLz5cclxuICAgICAgICAgICAgICAgIDxSZWFsVGltZUxpc3QgcmVhbHRpbWU9eyB0aGlzLnByb3BzLnJlYWx0aW1lIH0gY2xhc3NOYW1lPVwicmVhbHRpbWVcIiAvPlxyXG4gICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICApO1xyXG4gICAgfVxyXG59XHJcbiIsIid1c2Ugc3RyaWN0JztcclxuXHJcbmxldCBtYXAgPSBuZXcgTWFwKHtcclxuICAgIGNvbnRhaW5lcjogZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1hcCcpLFxyXG4gICAgd2lkdGg6IHNjcmVlbi53aWR0aCxcclxuICAgIGhlaWdodDogc2NyZWVuLndpZHRoICogMC40LFxyXG4gICAgd29ybGRtYXA6IHdvcmxkbWFwXHJcbn0pO1xyXG5sZXQgbGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5saXN0Jyk7XHJcblxyXG5sZXQgb3JpZ2luID0ge30sXHJcbiAgICB0YXJnZXRzID0ge30sXHJcbiAgICByZWFsdGltZSA9IFtdO1xyXG5cclxuY29uc3Qgd3MgPSBuZXcgV2ViU29ja2V0KCd3czovL21ic2QuaXB2aWtpbmcuY29tOjQ0MycpO1xyXG53cy5vbm1lc3NhZ2UgPSBmdW5jdGlvbihlKSB7XHJcbiAgICBsZXQgZGF0YSA9IEpTT04ucGFyc2UoZS5kYXRhKTtcclxuICAgIGNvbnN0IHN0YXJ0ID0ge1xyXG4gICAgICAgIGxhdDogK2RhdGFbJ2xhdGl0dWRlJ10sXHJcbiAgICAgICAgbG9uOiArZGF0YVsnbG9uZ2l0dWRlJ11cclxuICAgIH07XHJcbiAgICBjb25zdCBlbmQgPSB7XHJcbiAgICAgICAgbGF0OiArZGF0YVsnbGF0aXR1ZGUyJ10sXHJcbiAgICAgICAgbG9uOiArZGF0YVsnbG9uZ2l0dWRlMiddXHJcbiAgICB9O1xyXG4gICAgY29uc3Qgb3JpQ291bnRyeSA9IHdvcmxkbWFwLm5hbWVbZGF0YVsnY291bnRyeWNvZGUnXV0gfHwgJ1Vua25vdyc7XHJcbiAgICBvcmlnaW5bb3JpQ291bnRyeV0gPyBvcmlnaW5bb3JpQ291bnRyeV0rKyA6IG9yaWdpbltvcmlDb3VudHJ5XSA9IDE7XHJcbiAgICBjb25zdCB0YXJDb3VudHJ5ID0gd29ybGRtYXAubmFtZVtkYXRhWydjb3VudHJ5Y29kZTInXV0gfHwgJ1Vua25vdyc7XHJcbiAgICB0YXJnZXRzW3RhckNvdW50cnldID8gdGFyZ2V0c1t0YXJDb3VudHJ5XSsrIDogdGFyZ2V0c1t0YXJDb3VudHJ5XSA9IDE7XHJcblxyXG4gICAgcmVhbHRpbWUucHVzaCh7XHJcbiAgICAgICAgVGltZTogbmV3IERhdGUoKS50b0xvY2FsZVN0cmluZygpLFxyXG4gICAgICAgIE9yaWdpbjogb3JpQ291bnRyeSxcclxuICAgICAgICBUYXJnZXRzOiB0YXJDb3VudHJ5LFxyXG4gICAgICAgIFR5cGU6IHNlcnZpY2VzW2RhdGFbJ2Rwb3J0J11dIHx8ICdVbmtub3cnXHJcbiAgICB9KTtcclxuXHJcbiAgICBpZihyZWFsdGltZS5sZW5ndGggPiA4KSByZWFsdGltZS5zaGlmdCgpO1xyXG5cclxuICAgIFJlYWN0LnJlbmRlcihcclxuICAgICAgICA8SW5mbyBjbGFzc05hbWU9XCJpbmZvXCIgb3JpZ2luPXsgb3JpZ2luIH0gdGFyZ2V0cz17IHRhcmdldHMgfSByZWFsdGltZT17IHJlYWx0aW1lIH0gLz4sXHJcbiAgICAgICAgbGlzdCk7XHJcblxyXG4gICAgbWFwLnRyaWdnZXIoc3RhcnQsIGVuZCk7XHJcbn07XHJcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==