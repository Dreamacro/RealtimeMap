"use strict";function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _get=function(t,e,a){for(var r=!0;r;){var n=t,i=e,s=a;o=l=c=void 0,r=!1,null===n&&(n=Function.prototype);var o=Object.getOwnPropertyDescriptor(n,i);if(void 0!==o){if("value"in o)return o.value;var c=o.get;return void 0===c?void 0:c.call(s)}var l=Object.getPrototypeOf(n);if(null===l)return void 0;t=l,e=i,a=s,r=!0}},_createClass=function(){function t(t,e){for(var a=0;a<e.length;a++){var r=e[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,a,r){return a&&t(e.prototype,a),r&&t(e,r),e}}(),Map=function(){function t(e){_classCallCheck(this,t),this.WIDTH=e.width,this.HEIGHT=.4*e.width,this.scale=this.WIDTH/1e3,this.canvas=document.createElement("canvas"),e.container.appendChild(this.canvas),this.canvas.width=this.WIDTH,this.canvas.height=this.HEIGHT,this.ctx=this.canvas.getContext("2d"),this.ctx.drawSvg("world.svg",0,0,this.WIDTH,this.HEIGHT),this.mapDate=this.ctx.getImageData(0,0,this.WIDTH,this.HEIGHT),this.container={},this.count=0}return _createClass(t,[{key:"trigger",value:function(t,e){t=this.getXY(t),e=this.getXY(e);var a=+new Date,r="#21b384",n="#e32528";if(!this.container[a]){var i={start:t,end:e,startColor:r,endColor:n,duration:1e3,radius:70+parseInt(20*Math.random()),stage:0};this.container[a]=i,this.count++||this.draw()}}},{key:"clear",value:function(){this.ctx.clearRect(0,0,this.WIDTH,this.HEIGHT),this.ctx.putImageData(this.mapDate,0,0)}},{key:"draw",value:function(){var t=+new Date;this.clear();var e=!0,a=!1,r=void 0;try{for(var n,i=Object.keys(this.container)[Symbol.iterator]();!(e=(n=i.next()).done);e=!0){var s=n.value,o=t-s,c=this.container[s];if(o<c.duration){var l=this.easeOutQuint(o,0,c.radius,c.duration),u=this.easeOutQuint(o>c.duration/2?o-c.duration/2:o,c.start.x,c.end.x-c.start.x,c.duration/2),h=this.easeOutQuint(o>c.duration/2?o-c.duration/2:o,c.start.y,c.end.y-c.start.y,c.duration/2),d=this.easeOutQuint(o,1,-1,c.duration);this.ctx.globalAlpha=d,this.ctx.strokeStyle=c.startColor,this.ctx.lineWidth=5,this.ctx.beginPath(),this.ctx.arc(c.start.x,c.start.y,l,0,2*Math.PI),this.ctx.stroke(),this.ctx.globalAlpha=.5,this.ctx.strokeStyle=c.endColor,this.ctx.beginPath(),o<c.duration/2?this.ctx.moveTo(c.start.x,c.start.y):this.ctx.moveTo(c.end.x,c.end.y),this.ctx.lineTo(u,h),this.ctx.stroke()}else if(o<2*c.duration){var l=this.easeOutQuint(o-c.duration,0,c.radius,c.duration),u=this.easeOutQuint(o-c.duration,c.start.x,c.end.x-c.start.x,c.duration),h=this.easeOutQuint(o-c.duration,c.start.y,c.end.y-c.start.y,c.duration),d=this.easeOutQuint(o-c.duration,1,-1,c.duration);this.ctx.globalAlpha=d,this.ctx.strokeStyle=c.endColor,this.ctx.lineWidth=5,this.ctx.beginPath(),this.ctx.arc(c.end.x,c.end.y,l,0,2*Math.PI),this.ctx.stroke()}else delete this.container[s],this.count--}}catch(m){a=!0,r=m}finally{try{!e&&i["return"]&&i["return"]()}finally{if(a)throw r}}this.count&&window.requestAnimationFrame(this.draw.bind(this))}},{key:"getXY",value:function(t){return{x:(2.6938*t.lon+465.4)*this.scale,y:(-2.6938*t.lat+227.066)*this.scale}}},{key:"easeOutQuint",value:function(t,e,a,r){return a*Math.sin(t/r*(Math.PI/2))+e}}]),t}(),AttackList=function(t){function e(){_classCallCheck(this,e),_get(Object.getPrototypeOf(e.prototype),"constructor",this).apply(this,arguments)}return _inherits(e,t),_createClass(e,[{key:"render",value:function(){var t=[],e=!0,a=!1,r=void 0;try{for(var n,i=Object.keys(this.props.list)[Symbol.iterator]();!(e=(n=i.next()).done);e=!0){var s=n.value;t.push({country:s,count:this.props.list[s]})}}catch(o){a=!0,r=o}finally{try{!e&&i["return"]&&i["return"]()}finally{if(a)throw r}}return React.createElement("table",{className:this.props.className},React.createElement("tr",null,React.createElement("th",null,"attackorigin"==this.props.className?"Origin":"Targets"),React.createElement("th",null,"Count")),t.sort(function(t,e){return e.count-t.count}).slice(0,9).map(function(t){return React.createElement("tr",null,React.createElement("td",null,t.country),React.createElement("td",null,t.count))}))}}]),e}(React.Component),RealTimeList=function(t){function e(){_classCallCheck(this,e),_get(Object.getPrototypeOf(e.prototype),"constructor",this).apply(this,arguments)}return _inherits(e,t),_createClass(e,[{key:"render",value:function(){return React.createElement("table",{className:this.props.className},React.createElement("tr",null,React.createElement("th",null,"Time"),React.createElement("th",null,"Origin"),React.createElement("th",null,"Targets"),React.createElement("th",null,"Type")),this.props.realtime.map(function(t){return React.createElement("tr",null,React.createElement("td",{width:"200"},t.Time),React.createElement("td",null,t.Origin),React.createElement("td",{width:"200"},t.Targets),React.createElement("td",null,t.Type))}))}}]),e}(React.Component),Info=function(t){function e(){_classCallCheck(this,e),_get(Object.getPrototypeOf(e.prototype),"constructor",this).apply(this,arguments)}return _inherits(e,t),_createClass(e,[{key:"render",value:function(){return React.createElement("div",{className:"info"},React.createElement(AttackList,{list:this.props.origin,className:"attackorigin"}),React.createElement(AttackList,{list:this.props.targets,className:"attacktargets"}),React.createElement(RealTimeList,{realtime:this.props.realtime,className:"realtime"}))}}]),e}(React.Component),map=new Map({container:document.querySelector(".map"),width:screen.width,worldmap:worldmap}),list=document.querySelector(".list"),origin={},targets={},realtime=[],ws=new WebSocket("ws://mbsd.ipviking.com:443");ws.onmessage=function(t){var e=JSON.parse(t.data),a={lat:+e.latitude,lon:+e.longitude},r={lat:+e.latitude2,lon:+e.longitude2},n=worldmap.name[e.countrycode]||"Unknow";origin[n]?origin[n]++:origin[n]=1;var i=worldmap.name[e.countrycode2]||"Unknow";targets[i]?targets[i]++:targets[i]=1,realtime.push({Time:(new Date).toLocaleString(),Origin:n,Targets:i,Type:services[e.dport]||"Unknow"}),realtime.length>8&&realtime.shift(),React.render(React.createElement(Info,{className:"info",origin:origin,targets:targets,realtime:realtime}),list),map.trigger(a,r)};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1hcC5qcyIsImluZm8uanN4IiwiYm9vdC5qcyJdLCJuYW1lcyI6WyJfaW5oZXJpdHMiLCJzdWJDbGFzcyIsInN1cGVyQ2xhc3MiLCJUeXBlRXJyb3IiLCJwcm90b3R5cGUiLCJPYmplY3QiLCJjcmVhdGUiLCJjb25zdHJ1Y3RvciIsInZhbHVlIiwiZW51bWVyYWJsZSIsIndyaXRhYmxlIiwiY29uZmlndXJhYmxlIiwic2V0UHJvdG90eXBlT2YiLCJfX3Byb3RvX18iLCJfY2xhc3NDYWxsQ2hlY2siLCJpbnN0YW5jZSIsIkNvbnN0cnVjdG9yIiwiX2dldCIsIl94IiwiX3gyIiwiX3gzIiwiX2FnYWluIiwib2JqZWN0IiwicHJvcGVydHkiLCJyZWNlaXZlciIsImRlc2MiLCJwYXJlbnQiLCJnZXR0ZXIiLCJ1bmRlZmluZWQiLCJGdW5jdGlvbiIsImdldE93blByb3BlcnR5RGVzY3JpcHRvciIsImdldCIsImNhbGwiLCJnZXRQcm90b3R5cGVPZiIsIl9jcmVhdGVDbGFzcyIsImRlZmluZVByb3BlcnRpZXMiLCJ0YXJnZXQiLCJwcm9wcyIsImkiLCJsZW5ndGgiLCJkZXNjcmlwdG9yIiwiZGVmaW5lUHJvcGVydHkiLCJrZXkiLCJwcm90b1Byb3BzIiwic3RhdGljUHJvcHMiLCJNYXAiLCJvcHRpb24iLCJ0aGlzIiwiV0lEVEgiLCJ3aWR0aCIsIkhFSUdIVCIsInNjYWxlIiwiY2FudmFzIiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50IiwiY29udGFpbmVyIiwiYXBwZW5kQ2hpbGQiLCJoZWlnaHQiLCJjdHgiLCJnZXRDb250ZXh0IiwiZHJhd1N2ZyIsIm1hcERhdGUiLCJnZXRJbWFnZURhdGEiLCJjb3VudCIsInN0YXJ0IiwiZW5kIiwiZ2V0WFkiLCJ0aW1lc3RhbXAiLCJEYXRlIiwic3RhcnRDb2xvciIsImVuZENvbG9yIiwiaW5mbyIsImR1cmF0aW9uIiwicmFkaXVzIiwicGFyc2VJbnQiLCJNYXRoIiwicmFuZG9tIiwic3RhZ2UiLCJkcmF3IiwiY2xlYXJSZWN0IiwicHV0SW1hZ2VEYXRhIiwibm93IiwiY2xlYXIiLCJfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uIiwiX2RpZEl0ZXJhdG9yRXJyb3IiLCJfaXRlcmF0b3JFcnJvciIsIl9zdGVwIiwiX2l0ZXJhdG9yIiwia2V5cyIsIlN5bWJvbCIsIml0ZXJhdG9yIiwibmV4dCIsImRvbmUiLCJ0aW1lIiwiciIsImVhc2VPdXRRdWludCIsIm9mZnNldHgiLCJ4Iiwib2Zmc2V0eSIsInkiLCJvcGFjaXR5IiwiZ2xvYmFsQWxwaGEiLCJzdHJva2VTdHlsZSIsImxpbmVXaWR0aCIsImJlZ2luUGF0aCIsImFyYyIsIlBJIiwic3Ryb2tlIiwibW92ZVRvIiwibGluZVRvIiwiZXJyIiwid2luZG93IiwicmVxdWVzdEFuaW1hdGlvbkZyYW1lIiwiYmluZCIsImxvbiIsImxhdCIsInQiLCJiIiwiYyIsImQiLCJzaW4iLCJBdHRhY2tMaXN0IiwiX1JlYWN0JENvbXBvbmVudCIsImFwcGx5IiwiYXJndW1lbnRzIiwiY291bnRyeSIsIl9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24yIiwiX2RpZEl0ZXJhdG9yRXJyb3IyIiwiX2l0ZXJhdG9yRXJyb3IyIiwiX3N0ZXAyIiwiX2l0ZXJhdG9yMiIsImxpc3QiLCJwdXNoIiwiUmVhY3QiLCJjbGFzc05hbWUiLCJzb3J0IiwiYSIsInNsaWNlIiwibWFwIiwiaXRlbSIsIkNvbXBvbmVudCIsIlJlYWxUaW1lTGlzdCIsIl9SZWFjdCRDb21wb25lbnQyIiwicmVhbHRpbWUiLCJUaW1lIiwiT3JpZ2luIiwiVGFyZ2V0cyIsIlR5cGUiLCJJbmZvIiwiX1JlYWN0JENvbXBvbmVudDMiLCJvcmlnaW4iLCJ0YXJnZXRzIiwicXVlcnlTZWxlY3RvciIsInNjcmVlbiIsIndvcmxkbWFwIiwid3MiLCJXZWJTb2NrZXQiLCJvbm1lc3NhZ2UiLCJlIiwiZGF0YSIsIkpTT04iLCJwYXJzZSIsIm9yaUNvdW50cnkiLCJuYW1lIiwidGFyQ291bnRyeSIsInRvTG9jYWxlU3RyaW5nIiwic2VydmljZXMi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QUF1RixjQUFBRSxTQUFBaEcsS0FBQVYsTUFBQTBHLFNBQUFULFVBQUEsa0JBTkFjLEdBQUFmLE1BQUFPLFdDMURBRixJQUFBLEdBQUE3RixNQUNBVSxVQUFBRixTQUFBbUcsY0FBQSxRQUNBdkcsTUFBQXdHLE9BQUF4RyxNQUNBeUcsU0FBQUEsV0FFQXZCLEtBQUE5RSxTQUFBbUcsY0FBQSxTQUVBRixVQUNBQyxXQUNBUixZQUVBWSxHQUFBLEdBQUFDLFdBQUEsNkJBQ0FELElBQUFFLFVBQUEsU0FBQUMsR0FDQSxHQUFBQyxHQUFBQyxLQUFBQyxNQUFBSCxFQUFBQyxNQUNBL0YsR0FDQW1ELEtBQUE0QyxFQUFBLFNBQ0E3QyxLQUFBNkMsRUFBQSxXQUVBOUYsR0FDQWtELEtBQUE0QyxFQUFBLFVBQ0E3QyxLQUFBNkMsRUFBQSxZQUVBRyxFQUFBUixTQUFBUyxLQUFBSixFQUFBLGNBQUEsUUFDQVQsUUFBQVksR0FBQVosT0FBQVksS0FBQVosT0FBQVksR0FBQSxDQUNBLElBQUFFLEdBQUFWLFNBQUFTLEtBQUFKLEVBQUEsZUFBQSxRQUNBUixTQUFBYSxHQUFBYixRQUFBYSxLQUFBYixRQUFBYSxHQUFBLEVBRUFyQixTQUFBWCxNQUNBWSxNQUFBLEdBQUE1RSxPQUFBaUcsaUJBQ0FwQixPQUFBaUIsRUFDQWhCLFFBQUFrQixFQUNBakIsS0FBQW1CLFNBQUFQLEVBQUEsUUFBQSxXQUdBaEIsU0FBQXhHLE9BQUEsR0FBQXdHLFNBQUF3QixRQUVBbEMsTUFBQW1DLE9BQ0FuQyxNQUFBL0UsY0FBQThGLE1BQUFkLFVBQUEsT0FBQWdCLE9BQUFBLE9BQUFDLFFBQUFBLFFBQUFSLFNBQUFBLFdBQ0FaLE1BRUFPLElBQUErQixRQUFBekcsRUFBQUMiLCJmaWxlIjoibWFwLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xyXG5jbGFzcyBNYXAge1xyXG4gICAgY29uc3RydWN0b3Iob3B0aW9uKSB7XHJcbiAgICAgICAgdGhpcy5XSURUSCA9IG9wdGlvbi53aWR0aDtcclxuICAgICAgICB0aGlzLkhFSUdIVCA9IG9wdGlvbi53aWR0aCAqIDAuNDtcclxuICAgICAgICB0aGlzLnNjYWxlID0gdGhpcy5XSURUSCAvIDEwMDA7XHJcblxyXG4gICAgICAgIHRoaXMuY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7XHJcbiAgICAgICAgb3B0aW9uLmNvbnRhaW5lci5hcHBlbmRDaGlsZCh0aGlzLmNhbnZhcyk7XHJcbiAgICAgICAgdGhpcy5jYW52YXMud2lkdGggPSB0aGlzLldJRFRIO1xyXG4gICAgICAgIHRoaXMuY2FudmFzLmhlaWdodCA9IHRoaXMuSEVJR0hUO1xyXG4gICAgICAgIHRoaXMuY3R4ID0gdGhpcy5jYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcclxuICAgICAgICB0aGlzLmN0eC5kcmF3U3ZnKCd3b3JsZC5zdmcnLCAwLCAwLCB0aGlzLldJRFRILCB0aGlzLkhFSUdIVCk7XHJcbiAgICAgICAgdGhpcy5tYXBEYXRlID0gdGhpcy5jdHguZ2V0SW1hZ2VEYXRhKDAsMCx0aGlzLldJRFRILHRoaXMuSEVJR0hUKTtcclxuICAgICAgICB0aGlzLmNvbnRhaW5lciA9IHt9O1xyXG4gICAgICAgIHRoaXMuY291bnQgPSAwOy8vIHF1ZXVl5oC75pWwXHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDop6blj5HliqjnlLtcclxuICAgICAqIEBwYXJhbSAge09iamVjdH0gc3RhcnRcclxuICAgICAqIEBwYXJhbSAge09iamVjdH0gZW5kXHJcbiAgICAgKiBAcmV0dXJuIHtudWxsfVxyXG4gICAgICovXHJcbiAgICB0cmlnZ2VyKHN0YXJ0LCBlbmQpIHtcclxuICAgICAgICBzdGFydCA9IHRoaXMuZ2V0WFkoc3RhcnQpO1xyXG4gICAgICAgIGVuZCA9IHRoaXMuZ2V0WFkoZW5kKTtcclxuICAgICAgICBjb25zdCB0aW1lc3RhbXAgPSArbmV3IERhdGU7XHJcbiAgICAgICAgY29uc3Qgc3RhcnRDb2xvciA9ICcjMjFiMzg0JztcclxuICAgICAgICBjb25zdCBlbmRDb2xvciA9ICcjZTMyNTI4JztcclxuICAgICAgICBpZih0aGlzLmNvbnRhaW5lclt0aW1lc3RhbXBdKSByZXR1cm47Ly8g5peg5aWIXHJcbiAgICAgICAgbGV0IGluZm8gPSB7XHJcbiAgICAgICAgICAgIHN0YXJ0OiBzdGFydCxcclxuICAgICAgICAgICAgZW5kOiBlbmQsXHJcbiAgICAgICAgICAgIHN0YXJ0Q29sb3I6IHN0YXJ0Q29sb3IsXHJcbiAgICAgICAgICAgIGVuZENvbG9yOiBlbmRDb2xvcixcclxuICAgICAgICAgICAgZHVyYXRpb246IDEwMDAsXHJcbiAgICAgICAgICAgIHJhZGl1czogNzAgKyBwYXJzZUludChNYXRoLnJhbmRvbSgpICogMjApLFxyXG4gICAgICAgICAgICBzdGFnZTogMFxyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmNvbnRhaW5lclt0aW1lc3RhbXBdID0gaW5mbztcclxuICAgICAgICBpZighKHRoaXMuY291bnQpKyspIHtcclxuICAgICAgICAgICAgdGhpcy5kcmF3KCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNsZWFyKCkge1xyXG4gICAgICAgIHRoaXMuY3R4LmNsZWFyUmVjdCgwLDAsdGhpcy5XSURUSCx0aGlzLkhFSUdIVCk7XHJcbiAgICAgICAgdGhpcy5jdHgucHV0SW1hZ2VEYXRhKHRoaXMubWFwRGF0ZSwgMCwgMCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDmuLLmn5NcclxuICAgICAqIEByZXR1cm4ge251bGx9XHJcbiAgICAgKi9cclxuICAgIGRyYXcoKSB7XHJcbiAgICAgICAgY29uc3Qgbm93ID0gK25ldyBEYXRlO1xyXG4gICAgICAgIHRoaXMuY2xlYXIoKTtcclxuICAgICAgICBmb3IobGV0IGtleSBvZiBPYmplY3Qua2V5cyh0aGlzLmNvbnRhaW5lcikpIHtcclxuICAgICAgICAgICAgY29uc3QgdGltZSA9IG5vdyAtIGtleTtcclxuICAgICAgICAgICAgY29uc3QgaW5mbyA9IHRoaXMuY29udGFpbmVyW2tleV07XHJcbiAgICAgICAgICAgIGlmKHRpbWUgPCBpbmZvLmR1cmF0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCByID0gdGhpcy5lYXNlT3V0UXVpbnQodGltZSwgMCwgaW5mby5yYWRpdXMsIGluZm8uZHVyYXRpb24pO1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgb2Zmc2V0eCA9IHRoaXMuZWFzZU91dFF1aW50KHRpbWUgPiBpbmZvLmR1cmF0aW9uIC8gMiA/IHRpbWUgLSBpbmZvLmR1cmF0aW9uIC8gMiA6IHRpbWUgLCBpbmZvLnN0YXJ0LngsIGluZm8uZW5kLnggLSBpbmZvLnN0YXJ0LngsIGluZm8uZHVyYXRpb24gLyAyKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IG9mZnNldHkgPSB0aGlzLmVhc2VPdXRRdWludCh0aW1lID4gaW5mby5kdXJhdGlvbiAvIDIgPyB0aW1lIC0gaW5mby5kdXJhdGlvbiAvIDIgOiB0aW1lLCBpbmZvLnN0YXJ0LnksIGluZm8uZW5kLnkgLSBpbmZvLnN0YXJ0LnksIGluZm8uZHVyYXRpb24gLyAyKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IG9wYWNpdHkgPSB0aGlzLmVhc2VPdXRRdWludCh0aW1lLCAxLCAtMSwgaW5mby5kdXJhdGlvbik7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gY2lyY2xlXHJcbiAgICAgICAgICAgICAgICB0aGlzLmN0eC5nbG9iYWxBbHBoYSA9IG9wYWNpdHk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmN0eC5zdHJva2VTdHlsZSA9IGluZm8uc3RhcnRDb2xvcjtcclxuICAgICAgICAgICAgICAgIHRoaXMuY3R4LmxpbmVXaWR0aCA9IDU7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmN0eC5iZWdpblBhdGgoKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuY3R4LmFyYyhpbmZvLnN0YXJ0LngsIGluZm8uc3RhcnQueSwgciwgMCwgMipNYXRoLlBJKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuY3R4LnN0cm9rZSgpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIGxpbmVcclxuICAgICAgICAgICAgICAgIHRoaXMuY3R4Lmdsb2JhbEFscGhhID0gMC41O1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jdHguc3Ryb2tlU3R5bGUgPSBpbmZvLmVuZENvbG9yO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jdHguYmVnaW5QYXRoKCk7XHJcbiAgICAgICAgICAgICAgICB0aW1lIDwgaW5mby5kdXJhdGlvbiAvIDIgPyB0aGlzLmN0eC5tb3ZlVG8oaW5mby5zdGFydC54LCBpbmZvLnN0YXJ0LnkpIDogdGhpcy5jdHgubW92ZVRvKGluZm8uZW5kLngsIGluZm8uZW5kLnkpO1xyXG4gICAgICAgICAgICAgICAgLy90aGlzLmN0eC5tb3ZlVG8oaW5mby5zdGFydC54LCBpbmZvLnN0YXJ0LnkpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jdHgubGluZVRvKG9mZnNldHgsIG9mZnNldHkpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jdHguc3Ryb2tlKCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZih0aW1lIDwgaW5mby5kdXJhdGlvbiAqIDIpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmVhc2VPdXRRdWludCh0aW1lIC0gaW5mby5kdXJhdGlvbiwgMCwgaW5mby5yYWRpdXMsIGluZm8uZHVyYXRpb24pO1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgb2Zmc2V0eCA9IHRoaXMuZWFzZU91dFF1aW50KHRpbWUgLSBpbmZvLmR1cmF0aW9uLCBpbmZvLnN0YXJ0LngsIGluZm8uZW5kLnggLSBpbmZvLnN0YXJ0LngsIGluZm8uZHVyYXRpb24pO1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgb2Zmc2V0eSA9IHRoaXMuZWFzZU91dFF1aW50KHRpbWUgLSBpbmZvLmR1cmF0aW9uLCBpbmZvLnN0YXJ0LnksIGluZm8uZW5kLnkgLSBpbmZvLnN0YXJ0LnksIGluZm8uZHVyYXRpb24pO1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgb3BhY2l0eSA9IHRoaXMuZWFzZU91dFF1aW50KHRpbWUgLSBpbmZvLmR1cmF0aW9uLCAxLCAtMSwgaW5mby5kdXJhdGlvbik7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gY2lyY2xlXHJcbiAgICAgICAgICAgICAgICB0aGlzLmN0eC5nbG9iYWxBbHBoYSA9IG9wYWNpdHk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmN0eC5zdHJva2VTdHlsZSA9IGluZm8uZW5kQ29sb3I7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmN0eC5saW5lV2lkdGggPSA1O1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jdHguYmVnaW5QYXRoKCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmN0eC5hcmMoaW5mby5lbmQueCwgaW5mby5lbmQueSwgciwgMCwgMipNYXRoLlBJKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuY3R4LnN0cm9rZSgpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIC8vIGxpbmVcclxuICAgICAgICAgICAgICAgIC8vIHRoaXMuY3R4Lmdsb2JhbEFscGhhID0gMC41O1xyXG4gICAgICAgICAgICAgICAgLy8gdGhpcy5jdHguc3Ryb2tlU3R5bGUgPSBpbmZvLmVuZENvbG9yO1xyXG4gICAgICAgICAgICAgICAgLy8gdGhpcy5jdHguYmVnaW5QYXRoKCk7XHJcbiAgICAgICAgICAgICAgICAvLyB0aGlzLmN0eC5tb3ZlVG8oaW5mby5lbmQueCwgaW5mby5lbmQueSk7XHJcbiAgICAgICAgICAgICAgICAvLyB0aGlzLmN0eC5saW5lVG8ob2Zmc2V0eCwgb2Zmc2V0eSk7XHJcbiAgICAgICAgICAgICAgICAvLyB0aGlzLmN0eC5zdHJva2UoKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLmNvbnRhaW5lcltrZXldO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jb3VudC0tO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKHRoaXMuY291bnQpIHtcclxuICAgICAgICAgICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSh0aGlzLmRyYXcuYmluZCh0aGlzKSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog57uP57qs5bqmMlhZXHJcbiAgICAgKiBAcGFyYW0gIHtPYmplY3R9IG9wdGlvblxyXG4gICAgICogQHJldHVybiB7T2JqZWN0fVxyXG4gICAgICovXHJcbiAgICBnZXRYWSAob3B0aW9uKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgeDogKG9wdGlvbi5sb24gKiAyLjY5MzggKyA0NjUuNCkgKiB0aGlzLnNjYWxlLFxyXG4gICAgICAgICAgICB5OiAob3B0aW9uLmxhdCAqIC0yLjY5MzggKyAyMjcuMDY2KSAqIHRoaXMuc2NhbGVcclxuICAgICAgICB9O1xyXG4gICAgfTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIOe8k+WKqOWHveaVsFxyXG4gICAgICogQHBhcmFtICB7TnVtYmVyfSB0IOWHhuehruaXtumXtFxyXG4gICAgICogQHBhcmFtICB7TnVtYmVyfSBiIOW8gOWni+WAvFxyXG4gICAgICogQHBhcmFtICB7TnVtYmVyfSBjIOaUueWPmOWAvFxyXG4gICAgICogQHBhcmFtICB7TnVtYmVyfSBkIOaAu+aXtumXtFxyXG4gICAgICogQHJldHVybiB7TnVtYmVyfSAgIHZhbHVlXHJcbiAgICAgKi9cclxuICAgICBlYXNlT3V0UXVpbnQgKHQsIGIsIGMsIGQpIHtcclxuIFx0XHRyZXR1cm4gYyAqIE1hdGguc2luKHQvZCAqIChNYXRoLlBJLzIpKSArIGI7XHJcbiBcdH1cclxufVxyXG4iLCJjbGFzcyBBdHRhY2tMaXN0IGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50IHtcclxuICAgIHJlbmRlcigpIHtcclxuICAgICAgICBsZXQgY291bnRyeSA9IFtdO1xyXG4gICAgICAgIGZvcihsZXQga2V5IG9mIE9iamVjdC5rZXlzKHRoaXMucHJvcHMubGlzdCkpIHtcclxuICAgICAgICAgICAgY291bnRyeS5wdXNoKHtcclxuICAgICAgICAgICAgICAgIGNvdW50cnk6IGtleSxcclxuICAgICAgICAgICAgICAgIGNvdW50OiB0aGlzLnByb3BzLmxpc3Rba2V5XVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiAoXHJcbiAgICAgICAgICAgIDx0YWJsZSBjbGFzc05hbWU9eyB0aGlzLnByb3BzLmNsYXNzTmFtZSB9PlxyXG4gICAgICAgICAgICAgICAgPHRyPlxyXG4gICAgICAgICAgICAgICAgICA8dGg+eyB0aGlzLnByb3BzLmNsYXNzTmFtZSA9PSAnYXR0YWNrb3JpZ2luJyA/ICdPcmlnaW4nIDogJ1RhcmdldHMnIH08L3RoPlxyXG4gICAgICAgICAgICAgICAgICA8dGg+Q291bnQ8L3RoPlxyXG4gICAgICAgICAgICAgICAgPC90cj5cclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBjb3VudHJ5XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zb3J0KChhLCBiKSA9PiBiLmNvdW50IC0gYS5jb3VudClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnNsaWNlKDAsIDkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5tYXAoKGl0ZW0pID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRyPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRkPnsgaXRlbS5jb3VudHJ5IH08L3RkPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRkPnsgaXRlbS5jb3VudCB9PC90ZD5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3RyPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgPC90YWJsZT5cclxuICAgICAgICApO1xyXG4gICAgfVxyXG59XHJcblxyXG5jbGFzcyBSZWFsVGltZUxpc3QgZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQge1xyXG4gICAgcmVuZGVyICgpIHtcclxuXHJcbiAgICAgICAgcmV0dXJuIChcclxuICAgICAgICAgICAgPHRhYmxlIGNsYXNzTmFtZT17IHRoaXMucHJvcHMuY2xhc3NOYW1lIH0+XHJcbiAgICAgICAgICAgICAgICA8dHI+XHJcbiAgICAgICAgICAgICAgICAgIDx0aD5UaW1lPC90aD5cclxuICAgICAgICAgICAgICAgICAgPHRoPk9yaWdpbjwvdGg+XHJcbiAgICAgICAgICAgICAgICAgIDx0aD5UYXJnZXRzPC90aD5cclxuICAgICAgICAgICAgICAgICAgPHRoPlR5cGU8L3RoPlxyXG4gICAgICAgICAgICAgICAgPC90cj5cclxuICAgICAgICAgICAgICAgIHsgdGhpcy5wcm9wcy5yZWFsdGltZS5tYXAoKGl0ZW0pID0+IHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICA8dHI+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgPHRkIHdpZHRoPVwiMjAwXCI+eyBpdGVtLlRpbWUgfTwvdGQ+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgPHRkPnsgaXRlbS5PcmlnaW4gfTwvdGQ+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgPHRkIHdpZHRoPVwiMjAwXCI+eyBpdGVtLlRhcmdldHMgfTwvdGQ+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgPHRkPnsgaXRlbS5UeXBlIH08L3RkPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICA8L3RyPlxyXG4gICAgICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICB9KSB9XHJcbiAgICAgICAgICAgIDwvdGFibGU+XHJcbiAgICAgICAgKTtcclxuICAgIH1cclxufVxyXG5cclxuY2xhc3MgSW5mbyBleHRlbmRzIFJlYWN0LkNvbXBvbmVudCB7XHJcbiAgICByZW5kZXIoKSB7XHJcbiAgICAgICAgcmV0dXJuIChcclxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJpbmZvXCI+XHJcbiAgICAgICAgICAgICAgICA8QXR0YWNrTGlzdCBsaXN0PXsgdGhpcy5wcm9wcy5vcmlnaW4gfSBjbGFzc05hbWU9XCJhdHRhY2tvcmlnaW5cIiAvPlxyXG4gICAgICAgICAgICAgICAgPEF0dGFja0xpc3QgbGlzdD17IHRoaXMucHJvcHMudGFyZ2V0cyB9IGNsYXNzTmFtZT1cImF0dGFja3RhcmdldHNcIiAvPlxyXG4gICAgICAgICAgICAgICAgPFJlYWxUaW1lTGlzdCByZWFsdGltZT17IHRoaXMucHJvcHMucmVhbHRpbWUgfSBjbGFzc05hbWU9XCJyZWFsdGltZVwiIC8+XHJcbiAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcbn1cclxuIiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxubGV0IG1hcCA9IG5ldyBNYXAoe1xyXG4gICAgY29udGFpbmVyOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubWFwJyksXHJcbiAgICB3aWR0aDogc2NyZWVuLndpZHRoLFxyXG4gICAgd29ybGRtYXA6IHdvcmxkbWFwXHJcbn0pO1xyXG5sZXQgbGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5saXN0Jyk7XHJcblxyXG5sZXQgb3JpZ2luID0ge30sXHJcbiAgICB0YXJnZXRzID0ge30sXHJcbiAgICByZWFsdGltZSA9IFtdO1xyXG5cclxuY29uc3Qgd3MgPSBuZXcgV2ViU29ja2V0KCd3czovL21ic2QuaXB2aWtpbmcuY29tOjQ0MycpO1xyXG53cy5vbm1lc3NhZ2UgPSBmdW5jdGlvbihlKSB7XHJcbiAgICBsZXQgZGF0YSA9IEpTT04ucGFyc2UoZS5kYXRhKTtcclxuICAgIGNvbnN0IHN0YXJ0ID0ge1xyXG4gICAgICAgIGxhdDogK2RhdGFbJ2xhdGl0dWRlJ10sXHJcbiAgICAgICAgbG9uOiArZGF0YVsnbG9uZ2l0dWRlJ11cclxuICAgIH07XHJcbiAgICBjb25zdCBlbmQgPSB7XHJcbiAgICAgICAgbGF0OiArZGF0YVsnbGF0aXR1ZGUyJ10sXHJcbiAgICAgICAgbG9uOiArZGF0YVsnbG9uZ2l0dWRlMiddXHJcbiAgICB9O1xyXG4gICAgY29uc3Qgb3JpQ291bnRyeSA9IHdvcmxkbWFwLm5hbWVbZGF0YVsnY291bnRyeWNvZGUnXV0gfHwgJ1Vua25vdyc7XHJcbiAgICBvcmlnaW5bb3JpQ291bnRyeV0gPyBvcmlnaW5bb3JpQ291bnRyeV0rKyA6IG9yaWdpbltvcmlDb3VudHJ5XSA9IDE7XHJcbiAgICBjb25zdCB0YXJDb3VudHJ5ID0gd29ybGRtYXAubmFtZVtkYXRhWydjb3VudHJ5Y29kZTInXV0gfHwgJ1Vua25vdyc7XHJcbiAgICB0YXJnZXRzW3RhckNvdW50cnldID8gdGFyZ2V0c1t0YXJDb3VudHJ5XSsrIDogdGFyZ2V0c1t0YXJDb3VudHJ5XSA9IDE7XHJcblxyXG4gICAgcmVhbHRpbWUucHVzaCh7XHJcbiAgICAgICAgVGltZTogbmV3IERhdGUoKS50b0xvY2FsZVN0cmluZygpLFxyXG4gICAgICAgIE9yaWdpbjogb3JpQ291bnRyeSxcclxuICAgICAgICBUYXJnZXRzOiB0YXJDb3VudHJ5LFxyXG4gICAgICAgIFR5cGU6IHNlcnZpY2VzW2RhdGFbJ2Rwb3J0J11dIHx8ICdVbmtub3cnXHJcbiAgICB9KTtcclxuXHJcbiAgICBpZihyZWFsdGltZS5sZW5ndGggPiA4KSByZWFsdGltZS5zaGlmdCgpO1xyXG5cclxuICAgIFJlYWN0LnJlbmRlcihcclxuICAgICAgICA8SW5mbyBjbGFzc05hbWU9XCJpbmZvXCIgb3JpZ2luPXsgb3JpZ2luIH0gdGFyZ2V0cz17IHRhcmdldHMgfSByZWFsdGltZT17IHJlYWx0aW1lIH0gLz4sXHJcbiAgICAgICAgbGlzdCk7XHJcblxyXG4gICAgbWFwLnRyaWdnZXIoc3RhcnQsIGVuZCk7XHJcbn07XHJcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==