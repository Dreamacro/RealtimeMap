"use strict";function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _get=function(t,e,a){for(var r=!0;r;){var n=t,i=e,s=a;c=l=o=void 0,r=!1,null===n&&(n=Function.prototype);var c=Object.getOwnPropertyDescriptor(n,i);if(void 0!==c){if("value"in c)return c.value;var o=c.get;return void 0===o?void 0:o.call(s)}var l=Object.getPrototypeOf(n);if(null===l)return void 0;t=l,e=i,a=s,r=!0}},_createClass=function(){function t(t,e){for(var a=0;a<e.length;a++){var r=e[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,a,r){return a&&t(e.prototype,a),r&&t(e,r),e}}(),Map=function(){function t(e){var a=this;_classCallCheck(this,t),this.WIDTH=e.width,this.HEIGHT=.4*e.width,this.scale=this.WIDTH/1e3,this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.canvas.width=this.WIDTH,this.canvas.height=this.HEIGHT,e.container.appendChild(this.canvas),this.ctx.drawSvg("world.svg",0,0,this.WIDTH,this.HEIGHT),this.mapDate=this.ctx.getImageData(0,0,this.WIDTH,this.HEIGHT),this.container={},this.count=0,this.particles={},this.particle=function(){var t=0;return function(e,r,n,i,s,c,o,l,u){a.particles[++t]={index:t,x:e,y:r,r:n,o:i,c:s,xv:c,yv:o,rv:l,ov:u}}}()}return _createClass(t,[{key:"trigger",value:function(t,e){t=this.getXY(t),e=this.getXY(e);var a=+new Date,r="#21b384",n="#e32528",i="#F8BD19";if(!this.container[a]){var s={start:t,end:e,startColor:r,endColor:n,particleColor:i,duration:1e3,radius:70+parseInt(20*Math.random()),stage:0,xv:(t.x-e.x)/500,yv:(t.y-e.y)/500};this.container[a]=s,this.count++||this.draw()}}},{key:"clear",value:function(){this.ctx.clearRect(0,0,this.WIDTH,this.HEIGHT),this.ctx.putImageData(this.mapDate,0,0)}},{key:"draw",value:function(){var t=+new Date;this.clear();var e=!0,a=!1,r=void 0;try{for(var n,i=Object.keys(this.particles)[Symbol.iterator]();!(e=(n=i.next()).done);e=!0){var s=n.value,c=this.particles[s];this.ctx.beginPath(),this.ctx.arc(c.x,c.y,c.r,0,2*Math.PI),this.ctx.globalAlpha=c.o,this.ctx.fillStyle=c.c,this.ctx.fill(),c.x+=c.xv,c.y+=c.yv,c.r+=c.rv,c.o+=c.ov,(c.r<0||c.o<0)&&delete this.particles[c.index]}}catch(o){a=!0,r=o}finally{try{!e&&i["return"]&&i["return"]()}finally{if(a)throw r}}var l=!0,u=!1,h=void 0;try{for(var p,m=Object.keys(this.container)[Symbol.iterator]();!(l=(p=m.next()).done);l=!0){var s=p.value,d=t-s,v=this.container[s];if(d<v.duration){var y=this.easeOutQuint(d,0,v.radius,v.duration),f=v.start.x+d/v.duration*(v.end.x-v.start.x),g=v.start.y+d/v.duration*(v.end.y-v.start.y),x=this.easeOutQuint(d,1,-1,v.duration);this.ctx.globalAlpha=x,this.ctx.strokeStyle=v.startColor,this.ctx.lineWidth=5,this.ctx.beginPath(),this.ctx.arc(v.start.x,v.start.y,y,0,2*Math.PI),this.ctx.stroke();var w=Math.sqrt(v.xv*v.xv+v.yv*v.yv)/5;1>w&&(w=1);for(var b=Math.ceil(w),k=w/b,E=0;b>E;E++)this.particle(f-v.xv*E/b,g-v.yv*E/b,7,k,v.particleColor,.6*Math.random(),.6*Math.random(),-.3,-.05*k)}else if(d<2*v.duration){var y=this.easeOutQuint(d-v.duration,0,v.radius,v.duration),x=this.easeOutQuint(d-v.duration,1,-1,v.duration);this.ctx.globalAlpha=x,this.ctx.strokeStyle=v.endColor,this.ctx.lineWidth=5,this.ctx.beginPath(),this.ctx.arc(v.end.x,v.end.y,y,0,2*Math.PI),this.ctx.stroke()}else delete this.container[s],this.count--}}catch(o){u=!0,h=o}finally{try{!l&&m["return"]&&m["return"]()}finally{if(u)throw h}}this.count&&window.requestAnimationFrame(this.draw.bind(this))}},{key:"getXY",value:function(t){return{x:(2.6938*t.lon+465.4)*this.scale,y:(-2.6938*t.lat+227.066)*this.scale}}},{key:"easeOutQuint",value:function(t,e,a,r){return a*Math.sin(t/r*(Math.PI/2))+e}}]),t}(),AttackList=function(t){function e(){_classCallCheck(this,e),_get(Object.getPrototypeOf(e.prototype),"constructor",this).apply(this,arguments)}return _inherits(e,t),_createClass(e,[{key:"render",value:function(){var t=[],e=!0,a=!1,r=void 0;try{for(var n,i=Object.keys(this.props.list)[Symbol.iterator]();!(e=(n=i.next()).done);e=!0){var s=n.value;t.push({country:s,count:this.props.list[s]})}}catch(c){a=!0,r=c}finally{try{!e&&i["return"]&&i["return"]()}finally{if(a)throw r}}return React.createElement("table",{className:this.props.className},React.createElement("tr",null,React.createElement("th",null,"attackorigin"==this.props.className?"Origin":"Targets"),React.createElement("th",null,"Count")),t.sort(function(t,e){return e.count-t.count}).slice(0,9).map(function(t){return React.createElement("tr",null,React.createElement("td",null,t.country),React.createElement("td",null,t.count))}))}}]),e}(React.Component),RealTimeList=function(t){function e(){_classCallCheck(this,e),_get(Object.getPrototypeOf(e.prototype),"constructor",this).apply(this,arguments)}return _inherits(e,t),_createClass(e,[{key:"render",value:function(){return React.createElement("table",{className:this.props.className},React.createElement("tr",null,React.createElement("th",null,"Time"),React.createElement("th",null,"Origin"),React.createElement("th",null,"Targets"),React.createElement("th",null,"Type")),this.props.realtime.map(function(t){return React.createElement("tr",null,React.createElement("td",{width:"200"},t.Time),React.createElement("td",null,t.Origin),React.createElement("td",{width:"200"},t.Targets),React.createElement("td",null,t.Type))}))}}]),e}(React.Component),Info=function(t){function e(){_classCallCheck(this,e),_get(Object.getPrototypeOf(e.prototype),"constructor",this).apply(this,arguments)}return _inherits(e,t),_createClass(e,[{key:"render",value:function(){return React.createElement("div",{className:"info"},React.createElement(AttackList,{list:this.props.origin,className:"attackorigin"}),React.createElement(AttackList,{list:this.props.targets,className:"attacktargets"}),React.createElement(RealTimeList,{realtime:this.props.realtime,className:"realtime"}))}}]),e}(React.Component),map=new Map({container:document.querySelector(".map"),width:screen.width,worldmap:worldmap}),list=document.querySelector(".list"),origin={},targets={},realtime=[],ws=new WebSocket("ws://mbsd.ipviking.com:443");ws.onmessage=function(t){var e=JSON.parse(t.data),a={lat:+e.latitude,lon:+e.longitude},r={lat:+e.latitude2,lon:+e.longitude2},n=worldmap.name[e.countrycode]||"Unknow";origin[n]?origin[n]++:origin[n]=1;var i=worldmap.name[e.countrycode2]||"Unknow";targets[i]?targets[i]++:targets[i]=1,realtime.push({Time:(new Date).toLocaleString(),Origin:n,Targets:i,Type:services[e.dport]||"Unknow"}),realtime.length>8&&realtime.shift(),React.render(React.createElement(Info,{className:"info",origin:origin,targets:targets,realtime:realtime}),list),map.trigger(a,r)},ws.onerror=function(t){alert("WebSocket发生异常，请重新刷新网页。"),console.log(t)};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1hcC5qcyIsImluZm8uanN4IiwiYm9vdC5qcyJdLCJuYW1lcyI6WyJfaW5oZXJpdHMiLCJzdWJDbGFzcyIsInN1cGVyQ2xhc3MiLCJUeXBlRXJyb3IiLCJwcm90b3R5cGUiLCJPYmplY3QiLCJjcmVhdGUiLCJjb25zdHJ1Y3RvciIsInZhbHVlIiwiZW51bWVyYWJsZSIsIndyaXRhYmxlIiwiY29uZmlndXJhYmxlIiwic2V0UHJvdG90eXBlT2YiLCJfX3Byb3RvX18iLCJfY2xhc3NDYWxsQ2hlY2siLCJpbnN0YW5jZSIsIkNvbnN0cnVjdG9yIiwiX2dldCIsIl94IiwiX3gyIiwiX3gzIiwiX2FnYWluIiwib2JqZWN0IiwicHJvcGVydHkiLCJyZWNlaXZlciIsImRlc2MiLCJwYXJlbnQiLCJnZXR0ZXIiLCJ1bmRlZmluZWQiLCJGdW5jdGlvbiIsImdldE93blByb3BlcnR5RGVzY3JpcHRvciIsImdldCIsImNhbGwiLCJnZXRQcm90b3R5cGVPZiIsIl9jcmVhdGVDbGFzcyIsImRlZmluZVByb3BlcnRpZXMiLCJ0YXJnZXQiLCJwcm9wcyIsImkiLCJsZW5ndGgiLCJkZXNjcmlwdG9yIiwiZGVmaW5lUHJvcGVydHkiLCJrZXkiLCJwcm90b1Byb3BzIiwic3RhdGljUHJvcHMiLCJNYXAiLCJvcHRpb24iLCJfdGhpcyIsInRoaXMiLCJXSURUSCIsIndpZHRoIiwiSEVJR0hUIiwic2NhbGUiLCJjYW52YXMiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJjdHgiLCJnZXRDb250ZXh0IiwiaGVpZ2h0IiwiY29udGFpbmVyIiwiYXBwZW5kQ2hpbGQiLCJkcmF3U3ZnIiwibWFwRGF0ZSIsImdldEltYWdlRGF0YSIsImNvdW50IiwicGFydGljbGVzIiwicGFydGljbGUiLCJuZXh0SW5kZXgiLCJ4IiwieSIsInIiLCJvIiwiYyIsInh2IiwieXYiLCJydiIsIm92IiwiaW5kZXgiLCJzdGFydCIsImVuZCIsImdldFhZIiwidGltZXN0YW1wIiwiRGF0ZSIsInN0YXJ0Q29sb3IiLCJlbmRDb2xvciIsInBhcnRpY2xlQ29sb3IiLCJpbmZvIiwiZHVyYXRpb24iLCJyYWRpdXMiLCJwYXJzZUludCIsIk1hdGgiLCJyYW5kb20iLCJzdGFnZSIsImRyYXciLCJjbGVhclJlY3QiLCJwdXRJbWFnZURhdGEiLCJub3ciLCJjbGVhciIsIl9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24iLCJfZGlkSXRlcmF0b3JFcnJvciIsIl9pdGVyYXRvckVycm9yIiwiX3N0ZXAiLCJfaXRlcmF0b3IiLCJrZXlzIiwiU3ltYm9sIiwiaXRlcmF0b3IiLCJuZXh0IiwiZG9uZSIsInAiLCJiZWdpblBhdGgiLCJhcmMiLCJQSSIsImdsb2JhbEFscGhhIiwiZmlsbFN0eWxlIiwiZmlsbCIsImVyciIsIl9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24yIiwiX2RpZEl0ZXJhdG9yRXJyb3IyIiwiX2l0ZXJhdG9yRXJyb3IyIiwiX3N0ZXAyIiwiX2l0ZXJhdG9yMiIsInRpbWUiLCJlYXNlT3V0UXVpbnQiLCJvZmZzZXR4Iiwib2Zmc2V0eSIsIm9wYWNpdHkiLCJzdHJva2VTdHlsZSIsImxpbmVXaWR0aCIsInN0cm9rZSIsIm51bVBhcnRpY2xlcyIsInNxcnQiLCJudW1QYXJ0aWNsZXNJbnQiLCJjZWlsIiwibnVtUGFydGljbGVzRGlmIiwiaiIsIndpbmRvdyIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsImJpbmQiLCJsb24iLCJsYXQiLCJ0IiwiYiIsImQiLCJzaW4iLCJBdHRhY2tMaXN0IiwiX1JlYWN0JENvbXBvbmVudCIsImFwcGx5IiwiYXJndW1lbnRzIiwiY291bnRyeSIsIl9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24zIiwiX2RpZEl0ZXJhdG9yRXJyb3IzIiwiX2l0ZXJhdG9yRXJyb3IzIiwiX3N0ZXAzIiwiX2l0ZXJhdG9yMyIsImxpc3QiLCJwdXNoIiwiUmVhY3QiLCJjbGFzc05hbWUiLCJzb3J0IiwiYSIsInNsaWNlIiwibWFwIiwiaXRlbSIsIkNvbXBvbmVudCIsIlJlYWxUaW1lTGlzdCIsIl9SZWFjdCRDb21wb25lbnQyIiwicmVhbHRpbWUiLCJUaW1lIiwiT3JpZ2luIiwiVGFyZ2V0cyIsIlR5cGUiLCJJbmZvIiwiX1JlYWN0JENvbXBvbmVudDMiLCJvcmlnaW4iLCJ0YXJnZXRzIiwicXVlcnlTZWxlY3RvciIsInNjcmVlbiIsIndvcmxkbWFwIiwid3MiLCJXZWJTb2NrZXQiLCJvbm1lc3NhZ2UiLCJlIiwiZGF0YSIsIkpTT04iLCJwYXJzZSIsIm9yaUNvdW50cnkiLCJuYW1lIiwidGFyQ291bnRyeSIsInRvTG9jYWxlU3RyaW5nIiwic2VydmljZXMiLCJzaGlmdCIsInJlbmRlciIsInRyaWdnZXIiLCJvbmVycm9yIiwiYWxlcnQiLCJjb25zb2xlIiwibG9nIl0sIm1hcHBpbmdzIjoiQUFBQSxZQU1BLFNBQVNBLFdBQVVDLEVBQVVDLEdBQWMsR0FBMEIsa0JBQWZBLElBQTRDLE9BQWZBLEVBQXVCLEtBQU0sSUFBSUMsV0FBVSxpRUFBb0VELEdBQWVELEdBQVNHLFVBQVlDLE9BQU9DLE9BQU9KLEdBQWNBLEVBQVdFLFdBQWFHLGFBQWVDLE1BQU9QLEVBQVVRLFlBQVksRUFBT0MsVUFBVSxFQUFNQyxjQUFjLEtBQWVULElBQVlHLE9BQU9PLGVBQWlCUCxPQUFPTyxlQUFlWCxFQUFVQyxHQUFjRCxFQUFTWSxVQUFZWCxHQUVqZSxRQUFTWSxpQkFBZ0JDLEVBQVVDLEdBQWUsS0FBTUQsWUFBb0JDLElBQWdCLEtBQU0sSUFBSWIsV0FBVSxxQ0FOaEgsR0FBSWMsTUFBTyxTQUFhQyxFQUFJQyxFQUFLQyxHQUFxQyxJQUE5QixHQUFJQyxJQUFTLEVBQXdCQSxHQUFRLENBQUUsR0FBSUMsR0FBU0osRUFBSUssRUFBV0osRUFBS0ssRUFBV0osQ0FBS0ssR0FBT0MsRUFBU0MsRUFBU0MsT0FBV1AsR0FBUyxFQUFzQixPQUFYQyxJQUFpQkEsRUFBU08sU0FBU3pCLFVBQVcsSUFBSXFCLEdBQU9wQixPQUFPeUIseUJBQXlCUixFQUFRQyxFQUFXLElBQWFLLFNBQVRILEVBQUosQ0FBaU4sR0FBSSxTQUFXQSxHQUFR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RUFBQUMsSUFHQW1HLEdBQUFlLFFBQUEsU0FBQVosR0FDQWEsTUFBQSwwQkFDQUMsUUFBQUMsSUFBQWYiLCJmaWxlIjoibWFwLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xyXG5jbGFzcyBNYXAge1xyXG4gICAgY29uc3RydWN0b3Iob3B0aW9uKSB7XHJcbiAgICAgICAgdGhpcy5XSURUSCA9IG9wdGlvbi53aWR0aDtcclxuICAgICAgICB0aGlzLkhFSUdIVCA9IG9wdGlvbi53aWR0aCAqIDAuNDtcclxuICAgICAgICB0aGlzLnNjYWxlID0gdGhpcy5XSURUSCAvIDEwMDA7XHJcblxyXG4gICAgICAgIHRoaXMuY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7XHJcbiAgICAgICAgdGhpcy5jdHggPSB0aGlzLmNhbnZhcy5nZXRDb250ZXh0KCcyZCcpO1xyXG4gICAgICAgIHRoaXMuY2FudmFzLndpZHRoID0gdGhpcy5XSURUSDtcclxuICAgICAgICB0aGlzLmNhbnZhcy5oZWlnaHQgPSB0aGlzLkhFSUdIVDtcclxuICAgICAgICBvcHRpb24uY29udGFpbmVyLmFwcGVuZENoaWxkKHRoaXMuY2FudmFzKTtcclxuXHJcbiAgICAgICAgdGhpcy5jdHguZHJhd1N2Zygnd29ybGQuc3ZnJywgMCwgMCwgdGhpcy5XSURUSCwgdGhpcy5IRUlHSFQpO1xyXG4gICAgICAgIHRoaXMubWFwRGF0ZSA9IHRoaXMuY3R4LmdldEltYWdlRGF0YSgwLCAwLCB0aGlzLldJRFRILHRoaXMuSEVJR0hUKTtcclxuXHJcbiAgICAgICAgdGhpcy5jb250YWluZXIgPSB7fTtcclxuICAgICAgICB0aGlzLmNvdW50ID0gMDsvLyBxdWV1ZeaAu+aVsFxyXG5cclxuICAgICAgICB0aGlzLnBhcnRpY2xlcyA9IHt9XHJcbiAgICAgICAgdGhpcy5wYXJ0aWNsZSA9ICgoKSA9PiB7XHJcbiAgICAgICAgICBsZXQgbmV4dEluZGV4ID0gMDtcclxuICAgICAgICAgIHJldHVybiAoeCx5LHIsbyxjLHh2LHl2LHJ2LG92KSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMucGFydGljbGVzWysrbmV4dEluZGV4XSA9IHtcclxuICAgICAgICAgICAgICBpbmRleDogbmV4dEluZGV4LFxyXG4gICAgICAgICAgICAgIHg6IHgsXHJcbiAgICAgICAgICAgICAgeTogeSxcclxuICAgICAgICAgICAgICByOiByLFxyXG4gICAgICAgICAgICAgIG86IG8sXHJcbiAgICAgICAgICAgICAgYzogYyxcclxuICAgICAgICAgICAgICB4djogeHYsXHJcbiAgICAgICAgICAgICAgeXY6IHl2LFxyXG4gICAgICAgICAgICAgIHJ2OiBydixcclxuICAgICAgICAgICAgICBvdjogb3ZcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgIH07XHJcbiAgICAgICAgfSkoKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOinpuWPkeWKqOeUu1xyXG4gICAgICogQHBhcmFtICB7T2JqZWN0fSBzdGFydFxyXG4gICAgICogQHBhcmFtICB7T2JqZWN0fSBlbmRcclxuICAgICAqIEByZXR1cm4ge251bGx9XHJcbiAgICAgKi9cclxuICAgIHRyaWdnZXIoc3RhcnQsIGVuZCkge1xyXG4gICAgICAgIHN0YXJ0ID0gdGhpcy5nZXRYWShzdGFydCk7XHJcbiAgICAgICAgZW5kID0gdGhpcy5nZXRYWShlbmQpO1xyXG4gICAgICAgIGNvbnN0IHRpbWVzdGFtcCA9ICtuZXcgRGF0ZSxcclxuICAgICAgICAgICAgICBzdGFydENvbG9yID0gJyMyMWIzODQnLFxyXG4gICAgICAgICAgICAgIGVuZENvbG9yID0gJyNlMzI1MjgnLFxyXG4gICAgICAgICAgICAgIHBhcnRpY2xlQ29sb3IgPSAnI0Y4QkQxOSc7XHJcbiAgICAgICAgaWYodGhpcy5jb250YWluZXJbdGltZXN0YW1wXSkgcmV0dXJuO1xyXG4gICAgICAgIGxldCBpbmZvID0ge1xyXG4gICAgICAgICAgICBzdGFydDogc3RhcnQsXHJcbiAgICAgICAgICAgIGVuZDogZW5kLFxyXG4gICAgICAgICAgICBzdGFydENvbG9yOiBzdGFydENvbG9yLFxyXG4gICAgICAgICAgICBlbmRDb2xvcjogZW5kQ29sb3IsXHJcbiAgICAgICAgICAgIHBhcnRpY2xlQ29sb3I6IHBhcnRpY2xlQ29sb3IsXHJcbiAgICAgICAgICAgIGR1cmF0aW9uOiAxMDAwLFxyXG4gICAgICAgICAgICByYWRpdXM6IDcwICsgcGFyc2VJbnQoTWF0aC5yYW5kb20oKSAqIDIwKSxcclxuICAgICAgICAgICAgc3RhZ2U6IDAsXHJcbiAgICAgICAgICAgIHh2OiAoc3RhcnQueCAtIGVuZC54KSAvIDUwMCxcclxuICAgICAgICAgICAgeXY6IChzdGFydC55IC0gZW5kLnkpIC8gNTAwXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuY29udGFpbmVyW3RpbWVzdGFtcF0gPSBpbmZvO1xyXG4gICAgICAgIGlmKCEodGhpcy5jb3VudCkrKykge1xyXG4gICAgICAgICAgICB0aGlzLmRyYXcoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgY2xlYXIoKSB7XHJcbiAgICAgICAgdGhpcy5jdHguY2xlYXJSZWN0KDAsMCx0aGlzLldJRFRILHRoaXMuSEVJR0hUKTtcclxuICAgICAgICB0aGlzLmN0eC5wdXRJbWFnZURhdGEodGhpcy5tYXBEYXRlLCAwLCAwKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOa4suafk1xyXG4gICAgICogQHJldHVybiB7bnVsbH1cclxuICAgICAqL1xyXG4gICAgZHJhdygpIHtcclxuICAgICAgICBjb25zdCBub3cgPSArbmV3IERhdGU7XHJcbiAgICAgICAgdGhpcy5jbGVhcigpO1xyXG5cclxuICAgICAgICAvLyBwYXJ0aWNsZXNcclxuICAgICAgICBmb3IobGV0IGtleSBvZiBPYmplY3Qua2V5cyh0aGlzLnBhcnRpY2xlcykpIHtcclxuICAgICAgICAgICAgbGV0IHAgPSB0aGlzLnBhcnRpY2xlc1trZXldO1xyXG4gICAgICAgICAgICB0aGlzLmN0eC5iZWdpblBhdGgoKTtcclxuICAgICAgICAgICAgdGhpcy5jdHguYXJjKHAueCwgcC55LCBwLnIsIDAsIE1hdGguUEkqMik7XHJcbiAgICAgICAgICAgIHRoaXMuY3R4Lmdsb2JhbEFscGhhID0gcC5vO1xyXG4gICAgICAgICAgICB0aGlzLmN0eC5maWxsU3R5bGUgPSBwLmM7XHJcbiAgICAgICAgICAgIHRoaXMuY3R4LmZpbGwoKTtcclxuICAgICAgICAgICAgcC54ICs9IHAueHY7XHJcbiAgICAgICAgICAgIHAueSArPSBwLnl2O1xyXG4gICAgICAgICAgICBwLnIgKz0gcC5ydjtcclxuICAgICAgICAgICAgcC5vICs9IHAub3Y7XHJcbiAgICAgICAgICAgIGlmKHAuciA8IDAgfHwgcC5vIDwgMCkgZGVsZXRlIHRoaXMucGFydGljbGVzW3AuaW5kZXhdO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gZmlyZWJhbGxzIGFuZCBjaXJjbGVcclxuICAgICAgICBmb3IobGV0IGtleSBvZiBPYmplY3Qua2V5cyh0aGlzLmNvbnRhaW5lcikpIHtcclxuICAgICAgICAgICAgY29uc3QgdGltZSA9IG5vdyAtIGtleTtcclxuICAgICAgICAgICAgY29uc3QgaW5mbyA9IHRoaXMuY29udGFpbmVyW2tleV07XHJcbiAgICAgICAgICAgIGlmKHRpbWUgPCBpbmZvLmR1cmF0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCByID0gdGhpcy5lYXNlT3V0UXVpbnQodGltZSwgMCwgaW5mby5yYWRpdXMsIGluZm8uZHVyYXRpb24pO1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgb2Zmc2V0eCA9IGluZm8uc3RhcnQueCArIHRpbWUgLyBpbmZvLmR1cmF0aW9uICogKGluZm8uZW5kLnggLSBpbmZvLnN0YXJ0LngpO1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgb2Zmc2V0eSA9IGluZm8uc3RhcnQueSArIHRpbWUgLyBpbmZvLmR1cmF0aW9uICogKGluZm8uZW5kLnkgLSBpbmZvLnN0YXJ0LnkpO1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgb3BhY2l0eSA9IHRoaXMuZWFzZU91dFF1aW50KHRpbWUsIDEsIC0xLCBpbmZvLmR1cmF0aW9uKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBjaXJjbGVcclxuICAgICAgICAgICAgICAgIHRoaXMuY3R4Lmdsb2JhbEFscGhhID0gb3BhY2l0eTtcclxuICAgICAgICAgICAgICAgIHRoaXMuY3R4LnN0cm9rZVN0eWxlID0gaW5mby5zdGFydENvbG9yO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jdHgubGluZVdpZHRoID0gNTtcclxuICAgICAgICAgICAgICAgIHRoaXMuY3R4LmJlZ2luUGF0aCgpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jdHguYXJjKGluZm8uc3RhcnQueCwgaW5mby5zdGFydC55LCByLCAwLCAyKk1hdGguUEkpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jdHguc3Ryb2tlKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgbGV0IG51bVBhcnRpY2xlcyA9IE1hdGguc3FydChpbmZvLnh2KmluZm8ueHYgKyBpbmZvLnl2KmluZm8ueXYpIC8gNTtcclxuICAgICAgICAgICAgICAgIGlmKG51bVBhcnRpY2xlcyA8IDEpIG51bVBhcnRpY2xlcyA9IDE7XHJcbiAgICAgICAgICAgICAgICBsZXQgbnVtUGFydGljbGVzSW50ID0gTWF0aC5jZWlsKG51bVBhcnRpY2xlcyksXHJcbiAgICAgICAgICAgICAgICAgICAgbnVtUGFydGljbGVzRGlmID0gbnVtUGFydGljbGVzIC8gbnVtUGFydGljbGVzSW50O1xyXG4gICAgICAgICAgICAgICAgZm9yKGxldCBqID0gMDsgaiA8IG51bVBhcnRpY2xlc0ludDsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICAgIHRoaXMucGFydGljbGUoXHJcbiAgICAgICAgICAgICAgICAgICAgb2Zmc2V0eC1pbmZvLnh2KmovbnVtUGFydGljbGVzSW50LFxyXG4gICAgICAgICAgICAgICAgICAgIG9mZnNldHktaW5mby55dipqL251bVBhcnRpY2xlc0ludCxcclxuICAgICAgICAgICAgICAgICAgICA3LFxyXG4gICAgICAgICAgICAgICAgICAgIG51bVBhcnRpY2xlc0RpZixcclxuICAgICAgICAgICAgICAgICAgICBpbmZvLnBhcnRpY2xlQ29sb3IsXHJcbiAgICAgICAgICAgICAgICAgICAgTWF0aC5yYW5kb20oKSowLjYsXHJcbiAgICAgICAgICAgICAgICAgICAgTWF0aC5yYW5kb20oKSowLjYsXHJcbiAgICAgICAgICAgICAgICAgICAgLTAuMyxcclxuICAgICAgICAgICAgICAgICAgICAtMC4wNSpudW1QYXJ0aWNsZXNEaWZcclxuICAgICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIGlmKHRpbWUgPCBpbmZvLmR1cmF0aW9uICogMikge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgciA9IHRoaXMuZWFzZU91dFF1aW50KHRpbWUgLSBpbmZvLmR1cmF0aW9uLCAwLCBpbmZvLnJhZGl1cywgaW5mby5kdXJhdGlvbik7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBvcGFjaXR5ID0gdGhpcy5lYXNlT3V0UXVpbnQodGltZSAtIGluZm8uZHVyYXRpb24sIDEsIC0xLCBpbmZvLmR1cmF0aW9uKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBjaXJjbGVcclxuICAgICAgICAgICAgICAgIHRoaXMuY3R4Lmdsb2JhbEFscGhhID0gb3BhY2l0eTtcclxuICAgICAgICAgICAgICAgIHRoaXMuY3R4LnN0cm9rZVN0eWxlID0gaW5mby5lbmRDb2xvcjtcclxuICAgICAgICAgICAgICAgIHRoaXMuY3R4LmxpbmVXaWR0aCA9IDU7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmN0eC5iZWdpblBhdGgoKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuY3R4LmFyYyhpbmZvLmVuZC54LCBpbmZvLmVuZC55LCByLCAwLCAyKk1hdGguUEkpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jdHguc3Ryb2tlKCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5jb250YWluZXJba2V5XTtcclxuICAgICAgICAgICAgICAgIHRoaXMuY291bnQtLTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYodGhpcy5jb3VudCkge1xyXG4gICAgICAgICAgICB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKHRoaXMuZHJhdy5iaW5kKHRoaXMpKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDnu4/nuqzluqYgdG8gWFlcclxuICAgICAqIEBwYXJhbSAge09iamVjdH0gb3B0aW9uXHJcbiAgICAgKiBAcmV0dXJuIHtPYmplY3R9XHJcbiAgICAgKi9cclxuICAgIGdldFhZIChvcHRpb24pIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICB4OiAob3B0aW9uLmxvbiAqIDIuNjkzOCArIDQ2NS40KSAqIHRoaXMuc2NhbGUsXHJcbiAgICAgICAgICAgIHk6IChvcHRpb24ubGF0ICogLTIuNjkzOCArIDIyNy4wNjYpICogdGhpcy5zY2FsZVxyXG4gICAgICAgIH07XHJcbiAgICB9O1xyXG5cclxuICAgIC8qKlxyXG4gICAgICog57yT5Yqo5Ye95pWwXHJcbiAgICAgKiBAcGFyYW0gIHtOdW1iZXJ9IHQg5YeG56Gu5pe26Ze0XHJcbiAgICAgKiBAcGFyYW0gIHtOdW1iZXJ9IGIg5byA5aeL5YC8XHJcbiAgICAgKiBAcGFyYW0gIHtOdW1iZXJ9IGMg5pS55Y+Y5YC8XHJcbiAgICAgKiBAcGFyYW0gIHtOdW1iZXJ9IGQg5oC75pe26Ze0XHJcbiAgICAgKiBAcmV0dXJuIHtOdW1iZXJ9ICAgdmFsdWVcclxuICAgICAqL1xyXG4gICAgIGVhc2VPdXRRdWludCAodCwgYiwgYywgZCkge1xyXG4gXHRcdHJldHVybiBjICogTWF0aC5zaW4odC9kICogKE1hdGguUEkvMikpICsgYjtcclxuIFx0fVxyXG59XHJcbiIsImNsYXNzIEF0dGFja0xpc3QgZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQge1xyXG4gICAgcmVuZGVyKCkge1xyXG4gICAgICAgIGxldCBjb3VudHJ5ID0gW107XHJcbiAgICAgICAgZm9yKGxldCBrZXkgb2YgT2JqZWN0LmtleXModGhpcy5wcm9wcy5saXN0KSkge1xyXG4gICAgICAgICAgICBjb3VudHJ5LnB1c2goe1xyXG4gICAgICAgICAgICAgICAgY291bnRyeToga2V5LFxyXG4gICAgICAgICAgICAgICAgY291bnQ6IHRoaXMucHJvcHMubGlzdFtrZXldXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIChcclxuICAgICAgICAgICAgPHRhYmxlIGNsYXNzTmFtZT17IHRoaXMucHJvcHMuY2xhc3NOYW1lIH0+XHJcbiAgICAgICAgICAgICAgICA8dHI+XHJcbiAgICAgICAgICAgICAgICAgIDx0aD57IHRoaXMucHJvcHMuY2xhc3NOYW1lID09ICdhdHRhY2tvcmlnaW4nID8gJ09yaWdpbicgOiAnVGFyZ2V0cycgfTwvdGg+XHJcbiAgICAgICAgICAgICAgICAgIDx0aD5Db3VudDwvdGg+XHJcbiAgICAgICAgICAgICAgICA8L3RyPlxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvdW50cnlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnNvcnQoKGEsIGIpID0+IGIuY291bnQgLSBhLmNvdW50KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuc2xpY2UoMCwgOSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLm1hcCgoaXRlbSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dHI+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQ+eyBpdGVtLmNvdW50cnkgfTwvdGQ+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQ+eyBpdGVtLmNvdW50IH08L3RkPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdHI+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICA8L3RhYmxlPlxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcbn1cclxuXHJcbmNsYXNzIFJlYWxUaW1lTGlzdCBleHRlbmRzIFJlYWN0LkNvbXBvbmVudCB7XHJcbiAgICByZW5kZXIgKCkge1xyXG5cclxuICAgICAgICByZXR1cm4gKFxyXG4gICAgICAgICAgICA8dGFibGUgY2xhc3NOYW1lPXsgdGhpcy5wcm9wcy5jbGFzc05hbWUgfT5cclxuICAgICAgICAgICAgICAgIDx0cj5cclxuICAgICAgICAgICAgICAgICAgPHRoPlRpbWU8L3RoPlxyXG4gICAgICAgICAgICAgICAgICA8dGg+T3JpZ2luPC90aD5cclxuICAgICAgICAgICAgICAgICAgPHRoPlRhcmdldHM8L3RoPlxyXG4gICAgICAgICAgICAgICAgICA8dGg+VHlwZTwvdGg+XHJcbiAgICAgICAgICAgICAgICA8L3RyPlxyXG4gICAgICAgICAgICAgICAgeyB0aGlzLnByb3BzLnJlYWx0aW1lLm1hcCgoaXRlbSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDx0cj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQgd2lkdGg9XCIyMDBcIj57IGl0ZW0uVGltZSB9PC90ZD5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQ+eyBpdGVtLk9yaWdpbiB9PC90ZD5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQgd2lkdGg9XCIyMDBcIj57IGl0ZW0uVGFyZ2V0cyB9PC90ZD5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQ+eyBpdGVtLlR5cGUgfTwvdGQ+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDwvdHI+XHJcbiAgICAgICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgIH0pIH1cclxuICAgICAgICAgICAgPC90YWJsZT5cclxuICAgICAgICApO1xyXG4gICAgfVxyXG59XHJcblxyXG5jbGFzcyBJbmZvIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50IHtcclxuICAgIHJlbmRlcigpIHtcclxuICAgICAgICByZXR1cm4gKFxyXG4gICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImluZm9cIj5cclxuICAgICAgICAgICAgICAgIDxBdHRhY2tMaXN0IGxpc3Q9eyB0aGlzLnByb3BzLm9yaWdpbiB9IGNsYXNzTmFtZT1cImF0dGFja29yaWdpblwiIC8+XHJcbiAgICAgICAgICAgICAgICA8QXR0YWNrTGlzdCBsaXN0PXsgdGhpcy5wcm9wcy50YXJnZXRzIH0gY2xhc3NOYW1lPVwiYXR0YWNrdGFyZ2V0c1wiIC8+XHJcbiAgICAgICAgICAgICAgICA8UmVhbFRpbWVMaXN0IHJlYWx0aW1lPXsgdGhpcy5wcm9wcy5yZWFsdGltZSB9IGNsYXNzTmFtZT1cInJlYWx0aW1lXCIgLz5cclxuICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgKTtcclxuICAgIH1cclxufVxyXG4iLCIndXNlIHN0cmljdCc7XHJcblxyXG5sZXQgbWFwID0gbmV3IE1hcCh7XHJcbiAgICBjb250YWluZXI6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tYXAnKSxcclxuICAgIHdpZHRoOiBzY3JlZW4ud2lkdGgsXHJcbiAgICB3b3JsZG1hcDogd29ybGRtYXBcclxufSk7XHJcblxyXG5sZXQgbGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5saXN0Jyk7XHJcblxyXG5sZXQgb3JpZ2luID0ge30sXHJcbiAgICB0YXJnZXRzID0ge30sXHJcbiAgICByZWFsdGltZSA9IFtdO1xyXG5cclxuY29uc3Qgd3MgPSBuZXcgV2ViU29ja2V0KCd3czovL21ic2QuaXB2aWtpbmcuY29tOjQ0MycpO1xyXG53cy5vbm1lc3NhZ2UgPSBmdW5jdGlvbihlKSB7XHJcbiAgICBsZXQgZGF0YSA9IEpTT04ucGFyc2UoZS5kYXRhKTtcclxuICAgIGNvbnN0IHN0YXJ0ID0ge1xyXG4gICAgICAgIGxhdDogK2RhdGFbJ2xhdGl0dWRlJ10sXHJcbiAgICAgICAgbG9uOiArZGF0YVsnbG9uZ2l0dWRlJ11cclxuICAgIH07XHJcbiAgICBjb25zdCBlbmQgPSB7XHJcbiAgICAgICAgbGF0OiArZGF0YVsnbGF0aXR1ZGUyJ10sXHJcbiAgICAgICAgbG9uOiArZGF0YVsnbG9uZ2l0dWRlMiddXHJcbiAgICB9O1xyXG4gICAgY29uc3Qgb3JpQ291bnRyeSA9IHdvcmxkbWFwLm5hbWVbZGF0YVsnY291bnRyeWNvZGUnXV0gfHwgJ1Vua25vdyc7XHJcbiAgICBvcmlnaW5bb3JpQ291bnRyeV0gPyBvcmlnaW5bb3JpQ291bnRyeV0rKyA6IG9yaWdpbltvcmlDb3VudHJ5XSA9IDE7XHJcbiAgICBjb25zdCB0YXJDb3VudHJ5ID0gd29ybGRtYXAubmFtZVtkYXRhWydjb3VudHJ5Y29kZTInXV0gfHwgJ1Vua25vdyc7XHJcbiAgICB0YXJnZXRzW3RhckNvdW50cnldID8gdGFyZ2V0c1t0YXJDb3VudHJ5XSsrIDogdGFyZ2V0c1t0YXJDb3VudHJ5XSA9IDE7XHJcblxyXG4gICAgcmVhbHRpbWUucHVzaCh7XHJcbiAgICAgICAgVGltZTogbmV3IERhdGUoKS50b0xvY2FsZVN0cmluZygpLFxyXG4gICAgICAgIE9yaWdpbjogb3JpQ291bnRyeSxcclxuICAgICAgICBUYXJnZXRzOiB0YXJDb3VudHJ5LFxyXG4gICAgICAgIFR5cGU6IHNlcnZpY2VzW2RhdGFbJ2Rwb3J0J11dIHx8ICdVbmtub3cnXHJcbiAgICB9KTtcclxuXHJcbiAgICBpZihyZWFsdGltZS5sZW5ndGggPiA4KSByZWFsdGltZS5zaGlmdCgpO1xyXG5cclxuICAgIFJlYWN0LnJlbmRlcihcclxuICAgICAgICA8SW5mbyBjbGFzc05hbWU9XCJpbmZvXCIgb3JpZ2luPXsgb3JpZ2luIH0gdGFyZ2V0cz17IHRhcmdldHMgfSByZWFsdGltZT17IHJlYWx0aW1lIH0gLz4sXHJcbiAgICAgICAgbGlzdCk7XHJcblxyXG4gICAgbWFwLnRyaWdnZXIoc3RhcnQsIGVuZCk7XHJcbn07XHJcblxyXG53cy5vbmVycm9yID0gZnVuY3Rpb24gKGUpIHtcclxuICAgIGFsZXJ0KCdXZWJTb2NrZXTlj5HnlJ/lvILluLjvvIzor7fph43mlrDliLfmlrDnvZHpobXjgIInKTtcclxuICAgIGNvbnNvbGUubG9nKGUpO1xyXG59O1xyXG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=